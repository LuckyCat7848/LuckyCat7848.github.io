<?xml version="1.0" encoding="UTF-8"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title></title>
    <description>Everything is well !</description>
    <link>http://localhost:4000/</link>
    <atom:link href="http://localhost:4000/feed.xml" rel="self" type="application/rss+xml"/>
    <pubDate>Tue, 21 Mar 2017 23:33:52 +0800</pubDate>
    <lastBuildDate>Tue, 21 Mar 2017 23:33:52 +0800</lastBuildDate>
    <generator>Jekyll v3.3.0</generator>
    
      <item>
        <title>GPUImage学习总结</title>
        <description>&lt;ul id=&quot;markdown-toc&quot;&gt;
  &lt;li&gt;&lt;a href=&quot;#section&quot; id=&quot;markdown-toc-section&quot;&gt;一、介绍&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#section-1&quot; id=&quot;markdown-toc-section-1&quot;&gt;二、内置滤镜&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#section-2&quot; id=&quot;markdown-toc-section-2&quot;&gt;三、分段录制&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#gpuimage&quot; id=&quot;markdown-toc-gpuimage&quot;&gt;四、 GPUImage录制视频&lt;/a&gt;    &lt;ul&gt;
      &lt;li&gt;&lt;a href=&quot;#section-3&quot; id=&quot;markdown-toc-section-3&quot;&gt;4.1 基本设置&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#section-4&quot; id=&quot;markdown-toc-section-4&quot;&gt;4.2 开始录制&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#section-5&quot; id=&quot;markdown-toc-section-5&quot;&gt;4.3 停止录制&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#section-6&quot; id=&quot;markdown-toc-section-6&quot;&gt;4.4 视频拼接&lt;/a&gt;&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#section-7&quot; id=&quot;markdown-toc-section-7&quot;&gt;五、视频加滤镜功能&lt;/a&gt;    &lt;ul&gt;
      &lt;li&gt;&lt;a href=&quot;#section-8&quot; id=&quot;markdown-toc-section-8&quot;&gt;5.1 单个滤镜&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#section-9&quot; id=&quot;markdown-toc-section-9&quot;&gt;5.2 组合滤镜&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#section-10&quot; id=&quot;markdown-toc-section-10&quot;&gt;5.3 添加滤镜&lt;/a&gt;&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#mv&quot; id=&quot;markdown-toc-mv&quot;&gt;六、视频加MV功能&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#section-11&quot; id=&quot;markdown-toc-section-11&quot;&gt;七、学习&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h1 id=&quot;section&quot;&gt;一、介绍&lt;/h1&gt;
&lt;p&gt;GPUImage是Brad Larson在github托管的开源项目。&lt;/p&gt;

&lt;p&gt;GPUImage是一个基于GPU图像和视频处理的开源iOS框架，提供各种各样的图像处理滤镜，并且支持照相机和摄像机的实时滤镜； 基于GPU的图像加速，因此可以加速对实时摄像头视频、电影以及image的滤镜和其它效果处理，并且能够自定义图像滤镜。另外， GPUImage支持ARC。&lt;/p&gt;

&lt;p&gt;使用GPUImage处理图片比Core Image更简单，只需要将过滤器赋给图片对象即可，不用考虑context或者设备等其他问题。GPUImage提供了除高斯模糊外的其他几种不同效果的模糊，虽然Core Image也提供了几种模糊效果，但目前在iOS上能用的就只有高斯模糊，而GPUImage可用的有FastBlur, GaussianBlur, GaussianSelectiveBlur 和 BoxBlur。此外，作为开源框架的GPUImage还支持自定义的过滤器。&lt;/p&gt;

&lt;h1 id=&quot;section-1&quot;&gt;二、内置滤镜&lt;/h1&gt;
&lt;p&gt;共125个滤镜, 分为四类
Color adjustments: 31 filters, 颜色处理相关
Image processing: 40 filters, 图像处理相关.
Blending modes: 29 filters, 混合模式相关.
Visual effects: 25 filters, 视觉效果相关.&lt;/p&gt;

&lt;h1 id=&quot;section-2&quot;&gt;三、分段录制&lt;/h1&gt;
&lt;p&gt;参考&lt;a href=&quot;http://www.tuicool.com/articles/FVnumu&quot;&gt;AVFoundation和GPUImage初探&lt;/a&gt;。&lt;/p&gt;

&lt;p&gt;分段录制，每次录制都要创建一个movieWriter，每次都会在重新创建movieWriter并将它设置为videoCamera的 audioEncodingTarget 时候，界面都会卡顿一下，这是因为videoCamera默认是不录制声音的，而每次创建movieWriter的时候都用到了 movieWriter.hasAudioTrack = YES，调用这个之后videoCamera会自动去添加声音输入源，准备一些数据，所以这个过程会导致界面卡顿一下，下面这句代码很重要：&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;– &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;BOOL&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;addAudioInputsAndOutputs;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;videoCamera的头文件的注释是：录制的时候添加声音，添加输入源和输出源会暂时会使录制暂时卡住，所以在要使用声音的情况下要&lt;code class=&quot;highlighter-rouge&quot;&gt;先&lt;/code&gt;调用该方法来防止录制被卡住。&lt;/p&gt;

&lt;h1 id=&quot;gpuimage&quot;&gt;四、 GPUImage录制视频&lt;/h1&gt;
&lt;p&gt;转自&lt;a href=&quot;http://blog.sina.com.cn/s/blog_d0c0c80c0102xbo0.html&quot;&gt;GPUImage 录制视频注意事项&lt;/a&gt;，感谢&lt;a href=&quot;http://blog.sina.com.cn/u/3502295052&quot;&gt;我的个神啊&lt;/a&gt;的分享。&lt;/p&gt;

&lt;h2 id=&quot;section-3&quot;&gt;4.1 基本设置&lt;/h2&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;// 创建摄像头
self.videoCamera &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[[&lt;/span&gt;GPUImageVideoCamera alloc] initWithSessionPreset:AVCaptureSessionPreset640x480 cameraPosition:AVCaptureDevicePositionBack];

self.videoCamera.outputImageOrientation &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; UIInterfaceOrientationPortrait; // 输出图像旋转方式
self.videoCamera.horizontallyMirrorFrontFacingCamera &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; YES;

// 创建界面显示摄像内容
self.gpuImageView &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[[&lt;/span&gt;GPUImageView alloc] initWithFrame:frame];
self.gpuImageView.fillMode &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; kGPUImageFillModePreserveAspectRatioAndFill; // 显示模式充满整个边框
self.gpuImageView.clipsToBounds &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; YES;
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;self.gpuImageView.layer setMasksToBounds:YES];

// 滤镜
self.filter &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[[&lt;/span&gt;GPUImageBrightnessFilter alloc] init];
self.filter.brightness &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; 0.1f;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;h2 id=&quot;section-4&quot;&gt;4.2 开始录制&lt;/h2&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;// 该句可防止允许声音通过的情况下，避免录制第一帧黑屏闪屏卡顿现象（分段录制里有详解）
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;_camera addAudioInputsAndOutputs];

// 配置录制器
NSURL &lt;span class=&quot;k&quot;&gt;*&lt;/span&gt; saveURL &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;self fileURLForTempMovieByName:[NSString stringWithFormat:@&lt;span class=&quot;s2&quot;&gt;&quot;%d&quot;&lt;/span&gt;, videoFileNum]]; // 分段录制,videoFileNum:第几段
self.movieWriter &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[[&lt;/span&gt;GPUImageMovieWriter alloc] initWithMovieURL:saveURL  size:CGSizeMake&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;480.0f, 640.0f&lt;span class=&quot;o&quot;&gt;)]&lt;/span&gt;;

self.movieWriter.assetWriter.movieFragmentInterval &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; kCMTimeInvalid;
self.movieWriter.encodingLiveVideo &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; YES; // 影响其实是expectsMediaDataInRealTime属性，YES时用于输入流是实时的,比如说摄像头
self.movieWriter.hasAudioTrack &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; YES; // 开启声音采集
self.movieWriter.shouldPassthroughAudio &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; YES; // 是否使用源音源

&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;self.filter addTarget:self.movieWriter]; // 滤镜添加至moviewrite
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;self.filter addTarget:self.gpuImageView]; // 滤镜添加gpuimageview
self.videoCamera.audioEncodingTarget &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; self.movieWriter; // 音频来源是文件

// 开始录制
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;self.videoCamera startCameraCapture];
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;self.movieWriter startRecording];
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;h2 id=&quot;section-5&quot;&gt;4.3 停止录制&lt;/h2&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;self.filter removeTarget:self.movieWriter];
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;self.movieWriter finishRecording];
self.videoCamera.audioEncodingTarget &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; nil;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;h2 id=&quot;section-6&quot;&gt;4.4 视频拼接&lt;/h2&gt;

&lt;ul&gt;
  &lt;li&gt;4.4.1 AVFoundation基本知识点&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;AVAsset：媒体。&lt;/p&gt;

&lt;p&gt;AVAssetTrack：媒体轨道。&lt;/p&gt;

&lt;p&gt;AVMutableComposition ：包含了一个或多个给定类型的媒体轨道的容器。&lt;/p&gt;

&lt;p&gt;AVMutableCompositionTrack ：工程文件中的轨道，有音频轨、视频轨等，里面可以插入各种对应的素材。&lt;/p&gt;

&lt;p&gt;AVMutableVideoComposition：用来生成video的组合指令，包含多段instruction，可以决定最终视频的尺寸。&lt;/p&gt;

&lt;p&gt;AVMutableVideoCompositionInstruction：决定一个timeRange内每个轨道的状态，包含多个layerInstruction。&lt;/p&gt;

&lt;p&gt;AVMutableVideoCompositionLayerInstruction：决定视频轨道的效果:模糊、变形、裁剪,可创建出过渡效果。&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;4.4.2 分段视频的拼接&lt;/li&gt;
&lt;/ul&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c&quot;&gt;#pragma mark -&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;#pragma mark 视频拼接,视频和音频合成 存储为:MergerMovie&lt;/span&gt;
- &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;void&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;mergeAndSaveMovieWithFirstAsset:&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;AVAsset &lt;span class=&quot;k&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;firstAsset secondAsset:&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;AVAsset &lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;secondAsset &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
    
    static int mergerFileNum &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; 1; // 合成后的视频文件个数&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;因为是递归合成,不便删除上一个,所以有多个文件&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
    
    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;firstAsset !&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;nil &lt;span class=&quot;o&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; secondAsset!&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;nil&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
        // 1.创建组合mixComposition,用于合成视频,和声音&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;要分别创建组合轨道&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
        AVMutableComposition &lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;mixComposition &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[[&lt;/span&gt;AVMutableComposition alloc] init];
        // 2.创建1和2的视频轨道、音频轨道,都加入组合中mixComposition
        AVMutableCompositionTrack &lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;firstVideoTrack &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;mixComposition addMutableTrackWithMediaType:AVMediaTypeVideo
                                                                                 preferredTrackID:kCMPersistentTrackID_Invalid];
        &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;firstVideoTrack insertTimeRange:CMTimeRangeMake&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;kCMTimeZero, firstAsset.duration&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
                                 ofTrack:[[firstAsset tracksWithMediaType:AVMediaTypeVideo] objectAtIndex:0]
                                  atTime:kCMTimeZero
                                   error:nil];
        AVMutableCompositionTrack &lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;firstAudioTrack &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;mixComposition addMutableTrackWithMediaType:AVMediaTypeAudio
                                                                                 preferredTrackID:kCMPersistentTrackID_Invalid];
        &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;firstAudioTrack insertTimeRange:CMTimeRangeMake&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;kCMTimeZero, firstAsset.duration&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
                                 ofTrack:[[firstAsset tracksWithMediaType:AVMediaTypeAudio] objectAtIndex:0]
                                  atTime:kCMTimeZero
                                   error:nil];
        
        
        AVMutableCompositionTrack &lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;secondVideoTrack &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;mixComposition addMutableTrackWithMediaType:AVMediaTypeVideo
                                                                                  preferredTrackID:kCMPersistentTrackID_Invalid];
        &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;secondVideoTrack insertTimeRange:CMTimeRangeMake&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;kCMTimeZero, secondAsset.duration&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
                                  ofTrack:[[secondAsset tracksWithMediaType:AVMediaTypeVideo] objectAtIndex:0]
                                   atTime:firstAsset.duration
                                    error:nil];
        AVMutableCompositionTrack &lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;secondAudioTrack &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;mixComposition addMutableTrackWithMediaType:AVMediaTypeAudio
                                                                                  preferredTrackID:kCMPersistentTrackID_Invalid];
        &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;secondAudioTrack insertTimeRange:CMTimeRangeMake&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;kCMTimeZero, secondAsset.duration&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
                                  ofTrack:[[secondAsset tracksWithMediaType:AVMediaTypeAudio] objectAtIndex:0]
                                   atTime:firstAsset.duration
                                    error:nil];
        
        // 3.创建AVMutableVideoCompositionInstruction:一个指令，决定一个timeRange内每个轨道的状态，包含多个layerInstruction
        AVMutableVideoCompositionInstruction &lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;mainInstruction &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;AVMutableVideoCompositionInstruction videoCompositionInstruction];
        mainInstruction.timeRange &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; CMTimeRangeMake&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;kCMTimeZero, CMTimeAdd&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;firstAsset.duration, secondAsset.duration&lt;span class=&quot;o&quot;&gt;))&lt;/span&gt;;
        
        // 3-1.创建第一个AVMutableVideoCompositionLayerInstruction:决定视频轨道的效果:模糊、变形、裁剪,可创建出过渡效果
        AVMutableVideoCompositionLayerInstruction &lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;firstlayerInstruction &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;AVMutableVideoCompositionLayerInstruction videoCompositionLayerInstructionWithAssetTrack:firstVideoTrack];
        AVAssetTrack &lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;firstAssetTrack &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[[&lt;/span&gt;firstAsset tracksWithMediaType:AVMediaTypeVideo] objectAtIndex:0];
        UIImageOrientation firstAssetOrientation_  &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; UIImageOrientationUp;
        BOOL isFirstAssetPortrait_  &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; NO;
        CGAffineTransform firstTransform &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; firstAssetTrack.preferredTransform;
        &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;firstTransform.a &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; 0 &lt;span class=&quot;o&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; firstTransform.b &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; 1.0 &lt;span class=&quot;o&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; firstTransform.c &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; -1.0 &lt;span class=&quot;o&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; firstTransform.d &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; 0&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
            firstAssetOrientation_ &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; UIImageOrientationRight;
            isFirstAssetPortrait_ &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; YES;
        &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;firstTransform.a &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; 0 &lt;span class=&quot;o&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; firstTransform.b &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; -1.0 &lt;span class=&quot;o&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; firstTransform.c &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; 1.0 &lt;span class=&quot;o&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; firstTransform.d &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; 0&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
            firstAssetOrientation_ &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;  UIImageOrientationLeft;
            isFirstAssetPortrait_ &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; YES;
        &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;firstTransform.a &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; 1.0 &lt;span class=&quot;o&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; firstTransform.b &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; 0 &lt;span class=&quot;o&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; firstTransform.c &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; 0 &lt;span class=&quot;o&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; firstTransform.d &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; 1.0&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
            firstAssetOrientation_ &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;  UIImageOrientationUp;
        &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;firstTransform.a &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; -1.0 &lt;span class=&quot;o&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; firstTransform.b &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; 0 &lt;span class=&quot;o&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; firstTransform.c &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; 0 &lt;span class=&quot;o&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; firstTransform.d &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; -1.0&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
            firstAssetOrientation_ &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; UIImageOrientationDown;
        &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
        &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;firstlayerInstruction setTransform:firstAsset.preferredTransform atTime:kCMTimeZero];
        &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;firstlayerInstruction setOpacity:0.0 atTime:firstAsset.duration];
        
        // 3-2.创建第二个AVMutableVideoCompositionLayerInstruction
        AVMutableVideoCompositionLayerInstruction &lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;secondlayerInstruction &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;AVMutableVideoCompositionLayerInstruction videoCompositionLayerInstructionWithAssetTrack:secondVideoTrack];
        AVAssetTrack &lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;secondAssetTrack &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[[&lt;/span&gt;secondAsset tracksWithMediaType:AVMediaTypeVideo] objectAtIndex:0];
        UIImageOrientation secondAssetOrientation_  &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; UIImageOrientationUp;
        BOOL isSecondAssetPortrait_ &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; NO;
        CGAffineTransform secondTransform &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; secondAssetTrack.preferredTransform;
        &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;secondTransform.a &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; 0 &lt;span class=&quot;o&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; secondTransform.b &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; 1.0 &lt;span class=&quot;o&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; secondTransform.c &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; -1.0 &lt;span class=&quot;o&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; secondTransform.d &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; 0&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;nv&quot;&gt;secondAssetOrientation_&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; UIImageOrientationRight;
            isSecondAssetPortrait_ &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; YES;
        &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;secondTransform.a &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; 0 &lt;span class=&quot;o&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; secondTransform.b &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; -1.0 &lt;span class=&quot;o&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; secondTransform.c &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; 1.0 &lt;span class=&quot;o&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; secondTransform.d &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; 0&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
            secondAssetOrientation_ &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;  UIImageOrientationLeft;
            isSecondAssetPortrait_ &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; YES;
        &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;secondTransform.a &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; 1.0 &lt;span class=&quot;o&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; secondTransform.b &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; 0 &lt;span class=&quot;o&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; secondTransform.c &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; 0 &lt;span class=&quot;o&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; secondTransform.d &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; 1.0&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
            secondAssetOrientation_ &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;  UIImageOrientationUp;
        &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;secondTransform.a &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; -1.0 &lt;span class=&quot;o&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; secondTransform.b &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; 0 &lt;span class=&quot;o&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; secondTransform.c &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; 0 &lt;span class=&quot;o&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; secondTransform.d &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; -1.0&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
            secondAssetOrientation_ &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; UIImageOrientationDown;
        &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
        &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;secondlayerInstruction setTransform:secondAsset.preferredTransform atTime:firstAsset.duration];
        
        // AVMutableVideoComposition:用来生成video的组合指令,包含多段instruction,可以决定最终视频的尺寸
        // 3-3.AVMutableVideoComposition添加instructions
        mainInstruction.layerInstructions &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;NSArray arrayWithObjects:firstlayerInstruction, secondlayerInstruction,nil];
        AVMutableVideoComposition &lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;mainCompositionInst &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;AVMutableVideoComposition videoComposition];
        mainCompositionInst.instructions &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;NSArray arrayWithObject:mainInstruction];
        mainCompositionInst.frameDuration &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; CMTimeMake&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;1, 30&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;;
        
        CGSize naturalSizeFirst, naturalSizeSecond;
        &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;isFirstAssetPortrait_&lt;span class=&quot;o&quot;&gt;){&lt;/span&gt;
            naturalSizeFirst &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; CGSizeMake&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;firstAssetTrack.naturalSize.height, firstAssetTrack.naturalSize.width&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;;
        &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
            naturalSizeFirst &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; firstAssetTrack.naturalSize;
        &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;isSecondAssetPortrait_&lt;span class=&quot;o&quot;&gt;){&lt;/span&gt;
            naturalSizeSecond &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; CGSizeMake&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;secondAssetTrack.naturalSize.height, secondAssetTrack.naturalSize.width&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;;
        &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
            naturalSizeSecond &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; secondAssetTrack.naturalSize;
        &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
        
        float renderWidth, renderHeight;
        renderWidth &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; naturalSizeFirst.width &amp;gt; naturalSizeSecond.width ? naturalSizeFirst.width : naturalSizeSecond.width;
        renderHeight &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; naturalSizeFirst.height &amp;gt; naturalSizeSecond.height ? naturalSizeFirst.height : naturalSizeSecond.height;
        mainCompositionInst.renderSize &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; CGSizeMake&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;renderWidth, renderHeight&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;;
        
        // 4.获取路径
        NSURL &lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;url &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;self fileURLForTempMovieByName:[NSString stringWithFormat:@&lt;span class=&quot;s2&quot;&gt;&quot;MergerMovie%d&quot;&lt;/span&gt;, mergerFileNum]];
        
        // 5.创建AVAssetExportSession,用于导出合成好的视频
        AVAssetExportSession &lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;exporter &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[[&lt;/span&gt;AVAssetExportSession alloc] initWithAsset:mixComposition
                                                                          presetName:AVAssetExportPresetHighestQuality];
        exporter.outputURL&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;url;
        exporter.outputFileType &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; AVFileTypeMPEG4;//AVFileTypeQuickTimeMovie;
        exporter.shouldOptimizeForNetworkUse &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; YES;
        exporter.videoComposition &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; mainCompositionInst;
        __weak __typeof&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;self&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;weakSelf &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; self;
        &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;exporter exportAsynchronouslyWithCompletionHandler:^&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
            dispatch_async&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;dispatch_get_main_queue&lt;span class=&quot;o&quot;&gt;()&lt;/span&gt;, ^&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
                mergerFileNum ++;
                &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;mergerFileNum &amp;lt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;_videoArray count]&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
                    // 取合成好的视频和下一个,递归进行视频拼接,拼接后和音频合成
                    AVAsset &lt;span class=&quot;k&quot;&gt;*&lt;/span&gt; nextAsset &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;AVAsset assetWithURL:[_videoArray objectAtIndex:mergerFileNum]];
                    AVAsset &lt;span class=&quot;k&quot;&gt;*&lt;/span&gt; mergerVideo &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;AVAsset assetWithURL:[weakSelf fileURLForTempMovieByName:[NSString stringWithFormat:@&lt;span class=&quot;s2&quot;&gt;&quot;MergerMovie%d&quot;&lt;/span&gt;, mergerFileNum - 1]]];
                    &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;weakSelf mergeAndSaveMovieWithFirstAsset:mergerVideo secondAsset:nextAsset];
                &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
                    // 合成完成,导出
                    mergerFileFinally &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;NSString stringWithFormat:@&lt;span class=&quot;s2&quot;&gt;&quot;MergerMovie%d&quot;&lt;/span&gt;, mergerFileNum - 1];
                    mergerFileNum &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; 1;
                    &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;weakSelf exportDidFinish:exporter];
                &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
            &lt;span class=&quot;o&quot;&gt;})&lt;/span&gt;;
        &lt;span class=&quot;o&quot;&gt;}]&lt;/span&gt;;
    &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
- &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;void&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;exportDidFinish:&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;AVAssetExportSession&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;session &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
    __weak __typeof&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;self&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;weakSelf &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; self;
    dispatch_async&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;dispatch_get_main_queue&lt;span class=&quot;o&quot;&gt;()&lt;/span&gt;, ^&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;session.status &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; AVAssetExportSessionStatusCompleted&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
            // 视频拼接成功,取出视频中的音频
            &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;weakSelf getAudioSound];
        &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
            UIAlertView &lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;alert &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[[&lt;/span&gt;UIAlertView alloc] initWithTitle:@&lt;span class=&quot;s2&quot;&gt;&quot;Video Saved&quot;&lt;/span&gt; message:[NSString stringWithFormat:@&lt;span class=&quot;s2&quot;&gt;&quot;Saved To File Failed -- %d&quot;&lt;/span&gt;, session.status]
                                                           delegate:self cancelButtonTitle:@&lt;span class=&quot;s2&quot;&gt;&quot;OK&quot;&lt;/span&gt; otherButtonTitles:nil];
            &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;alert show];
        &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;})&lt;/span&gt;;
&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;ul&gt;
  &lt;li&gt;4.4.3 从合成的视频取出音频轨道&lt;/li&gt;
&lt;/ul&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;// 从合成好的视频中获取音频
- &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;void&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;getAudioSound &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
    AVURLAsset &lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;videoAsset &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;AVURLAsset URLAssetWithURL:[self fileURLForTempMovieByName:mergerFileFinally] options:nil];
    AVMutableComposition &lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;mixComposition &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[[&lt;/span&gt;AVMutableComposition alloc] init];
    //创建一个组合轨道,类型是AVMediaTypeAudio
    AVMutableCompositionTrack &lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;audioTrack &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;mixComposition addMutableTrackWithMediaType:AVMediaTypeAudio
                                                                        preferredTrackID:kCMPersistentTrackID_Invalid];
    
    //获取videoAsset中的音频轨道,插入组合轨道
    &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;audioTrack insertTimeRange:CMTimeRangeMake&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;kCMTimeZero, videoAsset.duration&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
                        ofTrack:[[videoAsset tracksWithMediaType:AVMediaTypeAudio] objectAtIndex:0] atTime:kCMTimeZero error:nil];
    
    NSString &lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;outFilePath &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[[&lt;/span&gt;self fileURLForTempSoundByName:@&lt;span class=&quot;s2&quot;&gt;&quot;MergerSound&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt; path];
    &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;self exportAudioAsset:audioTrack.asset toFilePath:outFilePath];
&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
- &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;BOOL&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;exportAudioAsset:&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;AVAsset &lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;avAsset toFilePath:&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;NSString &lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;filePath &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
    AVAssetExportSession &lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;exportSession &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;AVAssetExportSession
                                           exportSessionWithAsset:avAsset
                                           presetName:AVAssetExportPresetAppleM4A];
    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;nil &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; exportSession&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;return &lt;/span&gt;NO;//创建失败，则跳出
    
    exportSession.outputURL &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;NSURL fileURLWithPath:filePath]; // output path 新文件路径
    exportSession.outputFileType &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; AVFileTypeAppleM4A; // output file &lt;span class=&quot;nb&quot;&gt;type &lt;/span&gt;新文件类型
    
    __weak __typeof&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;self&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;weakSelf &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; self;
    &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;exportSession exportAsynchronouslyWithCompletionHandler:^&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt; //block
        &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;exportSession.status &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; AVAssetExportSessionStatusCompleted&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
            dispatch_async&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;dispatch_get_main_queue&lt;span class=&quot;o&quot;&gt;()&lt;/span&gt;, ^&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
                // 1.根据 Main.storyboard 的前缀 &lt;span class=&quot;s2&quot;&gt;&quot;Main&quot;&lt;/span&gt; 取到storyBoard 的地址
                UIStoryboard &lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;storyBoard &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;UIStoryboard storyboardWithName:@&lt;span class=&quot;s2&quot;&gt;&quot;Recording&quot;&lt;/span&gt; bundle:[NSBundle mainBundle]];
                // 2.根据事先在storyBoard中设置的 storyBoard ID 来获取相应的 ViewController
                VideoPlayViewController &lt;span class=&quot;k&quot;&gt;*&lt;/span&gt; videoPlay &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;storyBoard instantiateViewControllerWithIdentifier:@&lt;span class=&quot;s2&quot;&gt;&quot;VideoPlayViewController&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;;
                videoPlay.playUrl &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;weakSelf fileURLForTempMovieByName:mergerFileFinally];
                videoPlay.playSoundUrl &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;weakSelf fileURLForTempSoundByName:@&lt;span class=&quot;s2&quot;&gt;&quot;MergerSound&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;;
                &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;weakSelf.navigationController pushViewController:videoPlay animated:YES];
            &lt;span class=&quot;o&quot;&gt;})&lt;/span&gt;;
        &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
            dispatch_async&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;dispatch_get_main_queue&lt;span class=&quot;o&quot;&gt;()&lt;/span&gt;, ^&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
                UIAlertView &lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;alert &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[[&lt;/span&gt;UIAlertView alloc] initWithTitle:@&lt;span class=&quot;s2&quot;&gt;&quot;Audio Saved&quot;&lt;/span&gt; message:@&lt;span class=&quot;s2&quot;&gt;&quot;Saved To File Failed&quot;&lt;/span&gt;
                                                               delegate:self cancelButtonTitle:@&lt;span class=&quot;s2&quot;&gt;&quot;OK&quot;&lt;/span&gt; otherButtonTitles:nil];
                &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;alert show];
            &lt;span class=&quot;o&quot;&gt;})&lt;/span&gt;;
        &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;}]&lt;/span&gt;;
    &lt;span class=&quot;k&quot;&gt;return &lt;/span&gt;YES;
&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;ul&gt;
  &lt;li&gt;4.4.4 调用合成视频方法：&lt;/li&gt;
&lt;/ul&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;// 取第1,2段,进行视频拼接,拼接后取出完整音频,传界面
AVAsset &lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;firstAsset &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;AVAsset assetWithURL:_videoArray[0]];
AVAsset &lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;secondAsset &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;AVAsset assetWithURL:_videoArray[1]];
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;self mergeAndSaveMovieWithFirstAsset:firstAsset secondAsset:secondAsset];
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;h1 id=&quot;section-7&quot;&gt;五、视频加滤镜功能&lt;/h1&gt;

&lt;h2 id=&quot;section-8&quot;&gt;5.1 单个滤镜&lt;/h2&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;// 素描滤镜
GPUImageBrightnessFilter &lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;newFilter &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[[&lt;/span&gt;GPUImageBrightnessFilter alloc] init];
newFilter.brightness &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; 0.4f;
self.filter &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; newFilter;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;h2 id=&quot;section-9&quot;&gt;5.2 组合滤镜&lt;/h2&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;GPUImageRGBFilter &lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;filter1         &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[[&lt;/span&gt;GPUImageRGBFilter alloc] init];
GPUImageToonFilter &lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;filter2        &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[[&lt;/span&gt;GPUImageToonFilter alloc] init];
GPUImageColorInvertFilter &lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;filter3 &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[[&lt;/span&gt;GPUImageColorInvertFilter alloc] init];
GPUImageSepiaFilter       &lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;filter4 &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[[&lt;/span&gt;GPUImageSepiaFilter alloc] init];
&lt;span class=&quot;o&quot;&gt;[(&lt;/span&gt;GPUImageFilterGroup &lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;_filter addFilter:filter1];
&lt;span class=&quot;o&quot;&gt;[(&lt;/span&gt;GPUImageFilterGroup &lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;_filter addFilter:filter2];
&lt;span class=&quot;o&quot;&gt;[(&lt;/span&gt;GPUImageFilterGroup &lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;_filter addFilter:filter3];
&lt;span class=&quot;o&quot;&gt;[(&lt;/span&gt;GPUImageFilterGroup &lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;_filter addFilter:filter4];

&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;filter1 addTarget:filter2];
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;filter2 addTarget:filter3];
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;filter3 addTarget:filter4];
              
&lt;span class=&quot;o&quot;&gt;[(&lt;/span&gt;GPUImageFilterGroup &lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;_filter setInitialFilters:[NSArray arrayWithObject:filter1]];
&lt;span class=&quot;o&quot;&gt;[(&lt;/span&gt;GPUImageFilterGroup &lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;_filter setTerminalFilter:filter4];
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;h2 id=&quot;section-10&quot;&gt;5.3 添加滤镜&lt;/h2&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;// imageMovie
self.movieFile &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[[&lt;/span&gt;GPUImageMovie alloc] initWithURL:_playUrl];
_movieFile.runBenchmark &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; YES;
_movieFile.playAtActualSpeed &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; NO;
// 滤镜
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;_movieFile addTarget:_filter];
// GPUImageView
GPUImageView &lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;filterView &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[[&lt;/span&gt;GPUImageView alloc] init];
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;_filter addTarget:filterView];
     
// MovieWriter
self.movieWriter &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[[&lt;/span&gt;GPUImageMovieWriter alloc] initWithMovieURL:_currentMovieUrl size:CGSizeMake&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;480.0, 640.0&lt;span class=&quot;o&quot;&gt;)]&lt;/span&gt;;
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;_filter addTarget:_movieWriter];
        
_movieWriter.shouldPassthroughAudio &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; YES;
_movieFile.audioEncodingTarget &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; _movieWriter;
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;_movieFile enableSynchronizedEncodingUsingMovieWriter:_movieWriter];

// 开始处理
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;_movieWriter startRecording];
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;_movieFile startProcessing];

&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;self.player pause];
 _processing.hidden &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; NO;
 &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;_movieWriter setCompletionBlock:^&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
	 &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;_filter removeTarget:_movieWriter];
	 &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;_movieWriter finishRecording];
	 dispatch_async&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;dispatch_get_main_queue&lt;span class=&quot;o&quot;&gt;()&lt;/span&gt;, ^&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
		 _processing.hidden &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; YES;
     &lt;span class=&quot;o&quot;&gt;})&lt;/span&gt;;
&lt;span class=&quot;o&quot;&gt;}]&lt;/span&gt;;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;h1 id=&quot;mv&quot;&gt;六、视频加MV功能&lt;/h1&gt;
&lt;ul&gt;
  &lt;li&gt;代码有点乱，累了，不想整理了，大多同理吧。&lt;/li&gt;
&lt;/ul&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c&quot;&gt;#pragma mark -&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;#pragma mark - 🍎mv处理 1314&lt;/span&gt;
// 加mv处理
- &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;void&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;processMovieByMVUrl:&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;NSURL &lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;mvUrl &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;

    AVURLAsset &lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;firstAsset &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;AVURLAsset URLAssetWithURL:_playUrl options:nil];
    AVURLAsset &lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;secondAsset &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;AVURLAsset URLAssetWithURL:mvUrl options:nil];
 
    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;firstAsset.duration.value !&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; 0 &lt;span class=&quot;o&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; secondAsset.duration.value !&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; 0&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
        // 1 - Create AVMutableComposition object. This object will hold your AVMutableCompositionTrack instances.
        AVMutableComposition &lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;mixComposition &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[[&lt;/span&gt;AVMutableComposition alloc] init];
        // 2 - Create two video tracks
        AVMutableCompositionTrack &lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;firstTrack &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;mixComposition addMutableTrackWithMediaType:AVMediaTypeVideo
                                                                            preferredTrackID:kCMPersistentTrackID_Invalid];
        &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;firstTrack insertTimeRange:CMTimeRangeMake&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;kCMTimeZero, firstAsset.duration&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
                            ofTrack:[[firstAsset tracksWithMediaType:AVMediaTypeVideo] objectAtIndex:0]
                             atTime:kCMTimeZero
                              error:nil];
        AVMutableCompositionTrack &lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;secondTrack &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;mixComposition addMutableTrackWithMediaType:AVMediaTypeVideo
                                                                             preferredTrackID:kCMPersistentTrackID_Invalid];
        &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;secondTrack insertTimeRange:CMTimeRangeMake&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;kCMTimeZero, firstAsset.duration&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
                             ofTrack:[[secondAsset tracksWithMediaType:AVMediaTypeVideo] objectAtIndex:0]
                              atTime:kCMTimeZero // 🌲改
                               error:nil];
        
        // 2.1 - Create AVMutableVideoCompositionInstruction
        AVMutableVideoCompositionInstruction &lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;mainInstruction &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;AVMutableVideoCompositionInstruction videoCompositionInstruction];
        mainInstruction.timeRange &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; CMTimeRangeMake&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;kCMTimeZero,
                                                    firstAsset.duration&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;;
        
        // 2.2 - Create an AVMutableVideoCompositionLayerInstruction &lt;span class=&quot;k&quot;&gt;for &lt;/span&gt;the first track
        AVMutableVideoCompositionLayerInstruction &lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;firstlayerInstruction &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;AVMutableVideoCompositionLayerInstruction videoCompositionLayerInstructionWithAssetTrack:firstTrack];
        AVAssetTrack &lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;firstAssetTrack &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[[&lt;/span&gt;firstAsset tracksWithMediaType:AVMediaTypeVideo] objectAtIndex:0];
        UIImageOrientation firstAssetOrientation_  &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; UIImageOrientationUp;
        BOOL isFirstAssetPortrait_  &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; NO;
        CGAffineTransform firstTransform &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; firstAssetTrack.preferredTransform;
        &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;firstTransform.a &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; 0 &lt;span class=&quot;o&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; firstTransform.b &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; 1.0 &lt;span class=&quot;o&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; firstTransform.c &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; -1.0 &lt;span class=&quot;o&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; firstTransform.d &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; 0&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
            firstAssetOrientation_ &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; UIImageOrientationRight;
            isFirstAssetPortrait_ &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; YES;
        &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;firstTransform.a &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; 0 &lt;span class=&quot;o&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; firstTransform.b &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; -1.0 &lt;span class=&quot;o&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; firstTransform.c &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; 1.0 &lt;span class=&quot;o&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; firstTransform.d &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; 0&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
            firstAssetOrientation_ &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;  UIImageOrientationLeft;
            isFirstAssetPortrait_ &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; YES;
        &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;firstTransform.a &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; 1.0 &lt;span class=&quot;o&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; firstTransform.b &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; 0 &lt;span class=&quot;o&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; firstTransform.c &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; 0 &lt;span class=&quot;o&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; firstTransform.d &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; 1.0&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
            firstAssetOrientation_ &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;  UIImageOrientationUp;
        &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;firstTransform.a &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; -1.0 &lt;span class=&quot;o&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; firstTransform.b &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; 0 &lt;span class=&quot;o&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; firstTransform.c &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; 0 &lt;span class=&quot;o&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; firstTransform.d &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; -1.0&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
            firstAssetOrientation_ &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; UIImageOrientationDown;
        &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
        &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;firstlayerInstruction setTransform:firstAsset.preferredTransform atTime:kCMTimeZero];
       
        // 2.3 - Create an AVMutableVideoCompositionLayerInstruction &lt;span class=&quot;k&quot;&gt;for &lt;/span&gt;the second track
        AVMutableVideoCompositionLayerInstruction &lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;secondlayerInstruction &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;AVMutableVideoCompositionLayerInstruction videoCompositionLayerInstructionWithAssetTrack:secondTrack];
        AVAssetTrack &lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;secondAssetTrack &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[[&lt;/span&gt;secondAsset tracksWithMediaType:AVMediaTypeVideo] objectAtIndex:0];

        UIImageOrientation secondAssetOrientation_  &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; UIImageOrientationUp;
        BOOL isSecondAssetPortrait_ &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; NO;
        CGAffineTransform secondTransform &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; secondAssetTrack.preferredTransform;
        &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;secondTransform.a &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; 0 &lt;span class=&quot;o&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; secondTransform.b &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; 1.0 &lt;span class=&quot;o&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; secondTransform.c &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; -1.0 &lt;span class=&quot;o&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; secondTransform.d &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; 0&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;nv&quot;&gt;secondAssetOrientation_&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; UIImageOrientationRight;
            isSecondAssetPortrait_ &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; YES;
        &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;secondTransform.a &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; 0 &lt;span class=&quot;o&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; secondTransform.b &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; -1.0 &lt;span class=&quot;o&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; secondTransform.c &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; 1.0 &lt;span class=&quot;o&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; secondTransform.d &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; 0&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
            secondAssetOrientation_ &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;  UIImageOrientationLeft;
            isSecondAssetPortrait_ &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; YES;
        &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;secondTransform.a &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; 1.0 &lt;span class=&quot;o&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; secondTransform.b &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; 0 &lt;span class=&quot;o&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; secondTransform.c &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; 0 &lt;span class=&quot;o&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; secondTransform.d &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; 1.0&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
            secondAssetOrientation_ &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;  UIImageOrientationUp;
        &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;secondTransform.a &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; -1.0 &lt;span class=&quot;o&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; secondTransform.b &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; 0 &lt;span class=&quot;o&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; secondTransform.c &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; 0 &lt;span class=&quot;o&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; secondTransform.d &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; -1.0&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
            secondAssetOrientation_ &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; UIImageOrientationDown;
        &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
//        &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;secondlayerInstruction setTransform:secondAsset.preferredTransform atTime:firstAsset.duration];
        &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;secondlayerInstruction setTransform:secondAsset.preferredTransform atTime:kCMTimeZero];
        
        // 2.4 - Add instructions
        mainInstruction.layerInstructions &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;NSArray arrayWithObjects:firstlayerInstruction, secondlayerInstruction,nil];
        AVMutableVideoComposition &lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;mainCompositionInst &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;AVMutableVideoComposition videoComposition];
        mainCompositionInst.instructions &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;NSArray arrayWithObject:mainInstruction];
        mainCompositionInst.frameDuration &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; CMTimeMake&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;1, firstAsset.duration.value/firstAsset.duration.timescale&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;;
        
        CGSize naturalSizeFirst, naturalSizeSecond;
        &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;isFirstAssetPortrait_&lt;span class=&quot;o&quot;&gt;){&lt;/span&gt;
            naturalSizeFirst &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; CGSizeMake&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;firstAssetTrack.naturalSize.height, firstAssetTrack.naturalSize.width&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;;
        &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
            naturalSizeFirst &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; firstAssetTrack.naturalSize;
        &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;isSecondAssetPortrait_&lt;span class=&quot;o&quot;&gt;){&lt;/span&gt;
            naturalSizeSecond &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; CGSizeMake&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;secondAssetTrack.naturalSize.height, secondAssetTrack.naturalSize.width&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;;
        &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
            naturalSizeSecond &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; secondAssetTrack.naturalSize;
        &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
        
        float renderWidth, renderHeight;
        &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;naturalSizeFirst.width &amp;gt; naturalSizeSecond.width&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
            renderWidth &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; naturalSizeFirst.width;
        &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
            renderWidth &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; naturalSizeSecond.width;
        &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;naturalSizeFirst.height &amp;gt; naturalSizeSecond.height&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
            renderHeight &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; naturalSizeFirst.height;
        &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
            renderHeight &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; naturalSizeSecond.height;
        &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
//        &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;secondAsset increaseSize:[NSValue valueWithCGSize:CGSizeMake&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;480, 640&lt;span class=&quot;o&quot;&gt;)]]&lt;/span&gt;;
        &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;firstlayerInstruction setOpacity:0.5 atTime:kCMTimeZero]; //r34645🍎
//        &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;secondlayerInstruction setOpacity:0.5 atTime:kCMTimeZero]; //r34645🍎
        
        // 480, 640
        CGFloat result &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; renderWidth &amp;lt; renderHeight ? renderWidth : renderHeight;
        mainCompositionInst.renderSize &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; CGSizeMake&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;result, result&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;;

        // 3 - Audio track
        AVAsset &lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;audioAsset &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;AVAsset assetWithURL:_currentSoundUrl];
        &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;audioAsset!&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;nil&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
            AVMutableCompositionTrack &lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;AudioTrack &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;mixComposition addMutableTrackWithMediaType:AVMediaTypeAudio preferredTrackID:kCMPersistentTrackID_Invalid];
            &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;AudioTrack insertTimeRange:CMTimeRangeMake&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;kCMTimeZero, firstAsset.duration&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; ofTrack:[[audioAsset tracksWithMediaType:AVMediaTypeAudio] objectAtIndex:0] atTime:kCMTimeZero error:nil];
        &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
        
        // 4 - Get path
        NSURL &lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;url &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;self fileURLForFilterMovieByName:mvFile];
        &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;self removeFile:url];
        mvFile ++;
        // 5 - Create exporter
        AVAssetExportSession &lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;exporter &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[[&lt;/span&gt;AVAssetExportSession alloc] initWithAsset:mixComposition
                                                                          presetName:AVAssetExportPresetHighestQuality];
        exporter.outputURL&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;url;
        exporter.outputFileType &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; AVFileTypeQuickTimeMovie;
        exporter.shouldOptimizeForNetworkUse &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; YES;
        exporter.videoComposition &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; mainCompositionInst; // 加
        &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;exporter exportAsynchronouslyWithCompletionHandler:^&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
            dispatch_async&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;dispatch_get_main_queue&lt;span class=&quot;o&quot;&gt;()&lt;/span&gt;, ^&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
                &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;self exportDidFinish:exporter];
            &lt;span class=&quot;o&quot;&gt;})&lt;/span&gt;;
        &lt;span class=&quot;o&quot;&gt;}]&lt;/span&gt;;
    &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;h1 id=&quot;section-11&quot;&gt;七、学习&lt;/h1&gt;
&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;http://www.jianshu.com/p/722d65bac58d&quot;&gt;GPUImage详细解析（六）-用视频做视频水印&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;http://blog.csdn.net/xiaolinyeyi/article/details/50878996&quot;&gt;AVAsset、AVMutableComposition系列类的理解及视频裁剪示例
&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;http://blog.csdn.net/merrygoot/article/details/51804906&quot;&gt;iOS GPUImage之GPUImageFilterGroup组合滤镜（5）&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;http://www.tuicool.com/articles/FVnumu&quot;&gt;AVFoundation和GPUImage初探&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;http://blog.csdn.net/think_ma/article/details/43093331&quot;&gt;GPUImage.h简单说明&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

</description>
        <pubDate>Sat, 18 Mar 2017 01:43:12 +0800</pubDate>
        <link>http://localhost:4000/2017/03/18/GPUImage%E5%AD%A6%E4%B9%A0%E6%80%BB%E7%BB%93/</link>
        <guid isPermaLink="true">http://localhost:4000/2017/03/18/GPUImage%E5%AD%A6%E4%B9%A0%E6%80%BB%E7%BB%93/</guid>
        
        <category>Object-C</category>
        
        
        <category>技术</category>
        
      </item>
    
      <item>
        <title>二维码的识别与生成</title>
        <description>&lt;ul id=&quot;markdown-toc&quot;&gt;
  &lt;li&gt;&lt;a href=&quot;#iossdk&quot; id=&quot;markdown-toc-iossdk&quot;&gt;一、iOS原生SDK识别图片中的二维码&lt;/a&gt;    &lt;ul&gt;
      &lt;li&gt;&lt;a href=&quot;#section&quot; id=&quot;markdown-toc-section&quot;&gt;1.1 识别二维码的方法比较&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#avfoundation&quot; id=&quot;markdown-toc-avfoundation&quot;&gt;1.2 AVFoundation基本知识点&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#avfoundation-1&quot; id=&quot;markdown-toc-avfoundation-1&quot;&gt;1.3 用AVFoundation识别二维码实现&lt;/a&gt;&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#section-1&quot; id=&quot;markdown-toc-section-1&quot;&gt;二、生成二维码&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h1 id=&quot;iossdk&quot;&gt;一、iOS原生SDK识别图片中的二维码&lt;/h1&gt;

&lt;h2 id=&quot;section&quot;&gt;1.1 识别二维码的方法比较&lt;/h2&gt;

&lt;p&gt;在iOS中实现二维码和条形码扫描，我们所知的有，两大开源组件ZBar与ZXing. 这两大组件我们都有用过，这里总结下各自的缺点：
- &lt;strong&gt;ZBar&lt;/strong&gt;
ZBar在扫描的灵敏度上，和内存的使用上相对于ZXing上都是较优的，但是对于 “圆角二维码” 的扫描确很困难。&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;
    &lt;p&gt;&lt;strong&gt;ZXing&lt;/strong&gt;
ZXing 是 Google Code上的一个开源的条形码扫描库，是用java设计的，连Google Glass 都在使用的。但有人为了追求更高效率以及可移植性，出现了c++ port. Github上的Objectivc-C port，其实就是用OC代码封装了一下而已，而且已经停止维护。这样效率非常低，在instrument下面可以看到CPU和内存疯涨，在内存小的机器上很容易崩溃。&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;&lt;strong&gt;AVFoundation&lt;/strong&gt;
AVFoundation无论在扫描灵敏度和性能上来说都是最优的，所以毫无疑问我们应该切换到AVFoundation，需要兼容iOS 7或之前的版本可以用zbar或zxing代替。&lt;/p&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;avfoundation&quot;&gt;1.2 AVFoundation基本知识点&lt;/h2&gt;

&lt;ol&gt;
  &lt;li&gt;
    &lt;p&gt;AVCaptureDevice必须要引入AVFoundation.framework。&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;若是要检测装置是否提供该功能，可以透过下面方法来取得：&lt;/p&gt;
  &lt;/li&gt;
&lt;/ol&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;   -&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;BOOL&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;hasMediaType:&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;NSString &lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;mediaType
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;ol&gt;
  &lt;li&gt;取得摄像头后，我们可以透过下面属性来判断该摄像头是否有提供闪光灯：&lt;/li&gt;
&lt;/ol&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;
property&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;nonatomic, &lt;span class=&quot;nb&quot;&gt;readonly&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; BOOL hasTorch；
property&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;nonatomic, &lt;span class=&quot;nb&quot;&gt;readonly&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; BOOL hasFlash；

&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;ol&gt;
  &lt;li&gt;
    &lt;p&gt;闪光灯模式：使用Torch Mode。&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;相机设备在改变某些参数前必须先锁定，直到改变结束才能解锁:&lt;/p&gt;
  &lt;/li&gt;
&lt;/ol&gt;

&lt;blockquote&gt;
  &lt;p&gt;&lt;strong&gt;lockForConfiguration跟unlockForConfiguration是配对的API。&lt;/strong&gt;&lt;/p&gt;
&lt;/blockquote&gt;

&lt;h2 id=&quot;avfoundation-1&quot;&gt;1.3 用AVFoundation识别二维码实现&lt;/h2&gt;

&lt;p&gt;先保留着：&lt;a href=&quot;https://blog.cnbluebox.com/blog/2014/08/26/ioser-wei-ma-sao-miao/&quot;&gt;iOS二维码扫描,你需要注意的两件事&lt;/a&gt;&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;    //1.获取选择的图片
    UIImage &lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;image &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; info[UIImagePickerControllerOriginalImage];
    //2.初始化一个监测器
    CIDetector&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;detector &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;CIDetector detectorOfType:CIDetectorTypeQRCode context:nil options:@&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt; CIDetectorAccuracy : CIDetectorAccuracyHigh &lt;span class=&quot;o&quot;&gt;}]&lt;/span&gt;;
    
    &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;picker dismissViewControllerAnimated:YES completion:^&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
        //监测到的结果数组
        NSArray &lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;features &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;detector featuresInImage:[CIImage imageWithCGImage:image.CGImage]];
        &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;features.count &amp;gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;1&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
            /&lt;span class=&quot;k&quot;&gt;**&lt;/span&gt;结果对象 &lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;/
            CIQRCodeFeature &lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;feature &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;features objectAtIndex:0];
            NSString &lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;scannedResult &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; feature.messageString;
            UIAlertView &lt;span class=&quot;k&quot;&gt;*&lt;/span&gt; alertView &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[[&lt;/span&gt;UIAlertView alloc]initWithTitle:@&lt;span class=&quot;s2&quot;&gt;&quot;扫描结果&quot;&lt;/span&gt; message:scannedResult delegate:nil cancelButtonTitle:@&lt;span class=&quot;s2&quot;&gt;&quot;确定&quot;&lt;/span&gt; otherButtonTitles:nil, nil];
            &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;alertView show];
          
        &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;else&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
            UIAlertView &lt;span class=&quot;k&quot;&gt;*&lt;/span&gt; alertView &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[[&lt;/span&gt;UIAlertView alloc]initWithTitle:@&lt;span class=&quot;s2&quot;&gt;&quot;提示&quot;&lt;/span&gt; message:@&lt;span class=&quot;s2&quot;&gt;&quot;该图片没有包含一个二维码！&quot;&lt;/span&gt; delegate:nil cancelButtonTitle:@&lt;span class=&quot;s2&quot;&gt;&quot;确定&quot;&lt;/span&gt; otherButtonTitles:nil, nil];
            &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;alertView show];
            
        &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;}]&lt;/span&gt;;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;h1 id=&quot;section-1&quot;&gt;二、生成二维码&lt;/h1&gt;

&lt;ul&gt;
  &lt;li&gt;
    &lt;ol&gt;
      &lt;li&gt;导入CoreImage框架：&lt;/li&gt;
    &lt;/ol&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c&quot;&gt;#import &amp;lt;CoreImage/CoreImage.h&amp;gt;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;ul&gt;
  &lt;li&gt;
    &lt;ol&gt;
      &lt;li&gt;通过滤镜CIFilter生成二维码：&lt;/li&gt;
    &lt;/ol&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;/&lt;span class=&quot;k&quot;&gt;**&lt;/span&gt;
 &lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;  生成二维码
 &lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;/
- &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;void&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;creatCIQRCodeImage
&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
    // 1.创建过滤器，这里的@&lt;span class=&quot;s2&quot;&gt;&quot;CIQRCodeGenerator&quot;&lt;/span&gt;是固定的
    CIFilter &lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;filter &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;CIFilter filterWithName:@&lt;span class=&quot;s2&quot;&gt;&quot;CIQRCodeGenerator&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;;

    // 2.恢复默认设置
    &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;filter setDefaults];

    // 3. 给过滤器添加数据
    NSString &lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;dataString &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; @&lt;span class=&quot;s2&quot;&gt;&quot;二维码测试数据&quot;&lt;/span&gt;;
    NSData &lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;data &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;dataString dataUsingEncoding:NSUTF8StringEncoding];
    // 注意，这里的value必须是NSData类型
    &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;filter setValue:data forKeyPath:@&lt;span class=&quot;s2&quot;&gt;&quot;inputMessage&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;;

    // 4. 生成二维码
    CIImage &lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;outputImage &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;filter outputImage];

    // 5. 显示二维码
    self.imageView.image &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;UIImage imageWithCIImage:outputImage];
&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;通过上述方法生成的二维码图片比较模糊，第5步显示二维码的时候可以调用以下方法生成比较清晰的二维码。&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;/&lt;span class=&quot;k&quot;&gt;**&lt;/span&gt;
 &lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;  根据CIImage生成指定大小的UIImage
 &lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;
 &lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;  @param image CIImage
 &lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;  @param size  图片宽度
 &lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;
 &lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;  @return 生成高清的UIImage
 &lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;/
- &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;UIImage &lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;creatNonInterpolatedUIImageFormCIImage:&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;CIImage &lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;image withSize:&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;CGFloat&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;size
&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
    CGRect extent &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; CGRectIntegral&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;image.extent&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;;
    CGFloat scale &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; MIN&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;size/CGRectGetWidth&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;extent&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;, size/CGRectGetHeight&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;extent&lt;span class=&quot;o&quot;&gt;))&lt;/span&gt;;

    // 1. 创建bitmap
    size_t width &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; CGRectGetWidth&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;extent&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;*&lt;/span&gt; scale;
    size_t height &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; CGRectGetHeight&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;extent&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;*&lt;/span&gt; scale;
    CGColorSpaceRef cs &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; CGColorSpaceCreateDeviceGray&lt;span class=&quot;o&quot;&gt;()&lt;/span&gt;;
    CGContextRef bitmapRef &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; CGBitmapContextCreate&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;nil, width, height, 8, 0, cs, &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;CGBitmapInfo&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;kCGImageAlphaNone&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;;
    CIContext &lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;context &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;CIContext contextWithOptions:nil];
    CGImageRef bitmapImage &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;context createCGImage:image fromRect:extent];
    CGContextSetInterpolationQuality&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;bitmapRef, kCGInterpolationNone&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;;
    CGContextScaleCTM&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;bitmapRef, scale, scale&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;;
    CGContextDrawImage&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;bitmapRef, extent, bitmapImage&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;;

    // 2.保存bitmap图片
    CGImageRef scaledImage &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; CGBitmapContextCreateImage&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;bitmapRef&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;;
    CGContextRelease&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;bitmapRef&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;;
    CGImageRelease&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;bitmapImage&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;;
    &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;UIImage imageWithCGImage:scaledImage];
&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
</description>
        <pubDate>Tue, 07 Mar 2017 18:25:43 +0800</pubDate>
        <link>http://localhost:4000/2017/03/07/%E4%BA%8C%E7%BB%B4%E7%A0%81%E7%9A%84%E8%AF%86%E5%88%AB%E4%B8%8E%E7%94%9F%E6%88%90/</link>
        <guid isPermaLink="true">http://localhost:4000/2017/03/07/%E4%BA%8C%E7%BB%B4%E7%A0%81%E7%9A%84%E8%AF%86%E5%88%AB%E4%B8%8E%E7%94%9F%E6%88%90/</guid>
        
        <category>Object-C</category>
        
        
        <category>技术</category>
        
      </item>
    
      <item>
        <title>iOS动画笔记</title>
        <description>&lt;ul id=&quot;markdown-toc&quot;&gt;
  &lt;li&gt;&lt;a href=&quot;#uiviewanimationoptions&quot; id=&quot;markdown-toc-uiviewanimationoptions&quot;&gt;一、UIViewAnimationOptions枚举&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#coreanimation&quot; id=&quot;markdown-toc-coreanimation&quot;&gt;二、CoreAnimation&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;hr /&gt;

&lt;h1 id=&quot;uiviewanimationoptions&quot;&gt;一、UIViewAnimationOptions枚举&lt;/h1&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;
enum &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
   //这部分是基础属性的设置
   UIViewAnimationOptionLayoutSubviews            &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; 1 &lt;span class=&quot;sh&quot;&gt;&amp;lt;&amp;lt;  0,//设置子视图随父视图展示动画
   UIViewAnimationOptionAllowUserInteraction      = 1 &amp;lt;&amp;lt;  1,//允许在动画执行时用户与其进行交互
   UIViewAnimationOptionBeginFromCurrentState     = 1 &amp;lt;&amp;lt;  2,//允许在动画执行时执行新的动画
   UIViewAnimationOptionRepeat                    = 1 &amp;lt;&amp;lt;  3,//设置动画循环执行
   UIViewAnimationOptionAutoreverse               = 1 &amp;lt;&amp;lt;  4,//设置动画反向执行，必须和重复执行一起使用
   UIViewAnimationOptionOverrideInheritedDuration = 1 &amp;lt;&amp;lt;  5,//强制动画使用内层动画的时间值
   UIViewAnimationOptionOverrideInheritedCurve    = 1 &amp;lt;&amp;lt;  6,//强制动画使用内层动画曲线值
   UIViewAnimationOptionAllowAnimatedContent      = 1 &amp;lt;&amp;lt;  7,//设置动画视图实时刷新
   UIViewAnimationOptionShowHideTransitionViews   = 1 &amp;lt;&amp;lt;  8,//设置视图切换时隐藏，而不是移除
   UIViewAnimationOptionOverrideInheritedOptions  = 1 &amp;lt;&amp;lt;  9,//
   //这部分属性设置动画播放的线性效果
   UIViewAnimationOptionCurveEaseInOut            = 0 &amp;lt;&amp;lt; 16,//淡入淡出 首末减速
   UIViewAnimationOptionCurveEaseIn               = 1 &amp;lt;&amp;lt; 16,//淡入 初始减速
   UIViewAnimationOptionCurveEaseOut              = 2 &amp;lt;&amp;lt; 16,//淡出 末尾减速
   UIViewAnimationOptionCurveLinear               = 3 &amp;lt;&amp;lt; 16,//线性 匀速执行   
   //这部分设置UIView切换效果
   UIViewAnimationOptionTransitionNone            = 0 &amp;lt;&amp;lt; 20,
   UIViewAnimationOptionTransitionFlipFromLeft    = 1 &amp;lt;&amp;lt; 20,//从左边切入
   UIViewAnimationOptionTransitionFlipFromRight   = 2 &amp;lt;&amp;lt; 20,//从右边切入
   UIViewAnimationOptionTransitionCurlUp          = 3 &amp;lt;&amp;lt; 20,//从上面立体进入
   UIViewAnimationOptionTransitionCurlDown        = 4 &amp;lt;&amp;lt; 20,//从下面立体进入
   UIViewAnimationOptionTransitionCrossDissolve   = 5 &amp;lt;&amp;lt; 20,//溶解效果
   UIViewAnimationOptionTransitionFlipFromTop     = 6 &amp;lt;&amp;lt; 20,//从上面切入
   UIViewAnimationOptionTransitionFlipFromBottom  = 7 &amp;lt;&amp;lt; 20,//从下面切入
};

&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;提示：&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;
    &lt;p&gt;属性可以使用（Shift+\）(PS：因为格式问题输不出来就这样写了)进行多项合并。&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;这类的动画可以进行嵌套，其中有一点需要注意，内层动画的执行时间和曲线模式会默认继承外层动的，若要强制使用新的参数，使用如下的两个参数：&lt;/p&gt;
  &lt;/li&gt;
&lt;/ol&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;
UIViewAnimationOptionOverrideInheritedDuration &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; 1 &lt;span class=&quot;sh&quot;&gt;&amp;lt;&amp;lt;  5,//强制动画使用内层动画的时间值

UIViewAnimationOptionOverrideInheritedCurve    = 1 &amp;lt;&amp;lt;  6,//强制动画使用内层动画曲线值
   
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;h1 id=&quot;coreanimation&quot;&gt;二、CoreAnimation&lt;/h1&gt;

&lt;p&gt;&lt;img src=&quot;/source/iOS动画笔记/01.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;接受的类型是 CAAnimation 类型，有下面这些子类：&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;CABasicAnimation&lt;/strong&gt;：可设定起始结束两个关键帧的信息。&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;CAKeyframeAnimation&lt;/strong&gt;：除首尾外，还可添加多个中间关键点。&lt;/p&gt;

&lt;p&gt;**CAAnimationGroup **：可组合多个动画，因为上面两种动画一次只能设置一个属性值。&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;CATransition&lt;/strong&gt;：图层过渡动画，默认是淡入。比如修改一个 CALayer的背景色时，是从初始色慢慢淡入过渡到结束色。&lt;/p&gt;

&lt;p&gt;可修改为新颜色把旧颜色顶出去等效果。还可使用 CIFilter 滤镜做过渡效果，一些开源 UIViewController 的过渡动画使用了这种方式。&lt;/p&gt;

</description>
        <pubDate>Sun, 22 Jan 2017 15:44:12 +0800</pubDate>
        <link>http://localhost:4000/2017/01/22/iOS%E5%8A%A8%E7%94%BB%E7%AC%94%E8%AE%B0/</link>
        <guid isPermaLink="true">http://localhost:4000/2017/01/22/iOS%E5%8A%A8%E7%94%BB%E7%AC%94%E8%AE%B0/</guid>
        
        <category>Object-C</category>
        
        
        <category>技术</category>
        
      </item>
    
      <item>
        <title>如何使用我的博客作为Jekyll模版</title>
        <description>&lt;ul id=&quot;markdown-toc&quot;&gt;
  &lt;li&gt;&lt;a href=&quot;#section&quot; id=&quot;markdown-toc-section&quot;&gt;致谢&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#section-1&quot; id=&quot;markdown-toc-section-1&quot;&gt;使用&lt;/a&gt;    &lt;ul&gt;
      &lt;li&gt;&lt;a href=&quot;#section-2&quot; id=&quot;markdown-toc-section-2&quot;&gt;下载&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#section-3&quot; id=&quot;markdown-toc-section-3&quot;&gt;配置&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#section-4&quot; id=&quot;markdown-toc-section-4&quot;&gt;如何写文章&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#section-5&quot; id=&quot;markdown-toc-section-5&quot;&gt;执行&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#section-6&quot; id=&quot;markdown-toc-section-6&quot;&gt;效果&lt;/a&gt;&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#section-7&quot; id=&quot;markdown-toc-section-7&quot;&gt;关于重复造轮子&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#section-8&quot; id=&quot;markdown-toc-section-8&quot;&gt;关于作者&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h1 id=&quot;section&quot;&gt;致谢&lt;/h1&gt;
&lt;ul&gt;
  &lt;li&gt;感谢&lt;a href=&quot;https://github.com/&quot;&gt;Github&lt;/a&gt;提供的代码维护和发布平台。&lt;/li&gt;
  &lt;li&gt;感谢&lt;a href=&quot;https://jekyllrb.com/&quot;&gt;Jekyll&lt;/a&gt;团队做出如此优秀的产品&lt;/li&gt;
  &lt;li&gt;感谢原作者&lt;a href=&quot;https://github.com/luoyan35714/LessOrMore&quot;&gt;Freud Kang&lt;/a&gt;，从&lt;code class=&quot;highlighter-rouge&quot;&gt;2016.11&lt;/code&gt;起，我的博客选用了此样式模版。&lt;/li&gt;
&lt;/ul&gt;

&lt;h1 id=&quot;section-1&quot;&gt;使用&lt;/h1&gt;

&lt;h2 id=&quot;section-2&quot;&gt;下载&lt;/h2&gt;

&lt;p&gt;使用git从&lt;a href=&quot;https://github.com/LuckyCat7848/LuckyCat7848.github.io&quot;&gt;LessOrMore&lt;/a&gt;主页下载项目&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;git clone https://github.com/LuckyCat7848/LuckyCat7848.github.io.git
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;h2 id=&quot;section-3&quot;&gt;配置&lt;/h2&gt;

&lt;ul&gt;
  &lt;li&gt;下载下来后需要配置的文件&lt;code class=&quot;highlighter-rouge&quot;&gt;_config.yml&lt;/code&gt;，打开之后按照如下进行配置。&lt;/li&gt;
&lt;/ul&gt;

&lt;blockquote&gt;
  &lt;p&gt;特别注意&lt;code class=&quot;highlighter-rouge&quot;&gt;baseurl&lt;/code&gt;的配置。如果是&lt;code class=&quot;highlighter-rouge&quot;&gt;***.github.io&lt;/code&gt;项目，不修改为空’‘的话，会导致JS,CSS等静态资源无法找到的错误&lt;/p&gt;
&lt;/blockquote&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;name: 博客名称
email: 邮箱地址
author: 作者名
url: 个人网站
&lt;span class=&quot;c&quot;&gt;### baseurl修改为项目名，如果项目是'***.github.io'，则设置为空''&lt;/span&gt;
baseurl: &lt;span class=&quot;s2&quot;&gt;&quot;/LessOrMore&quot;&lt;/span&gt;
resume_site: 个人简历网站
github: github地址
github_username: github用户名称

markdown: kramdown
kramdown:
  input: GFM
  toc_levels: 1..6
  enable_coderay: &lt;span class=&quot;nb&quot;&gt;true
  &lt;/span&gt;syntax_highlighter: rouge
  
FB:
  comments :
    provider : uyan 
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;ul&gt;
  &lt;li&gt;因为我的博客使用的是&lt;a href=&quot;http://www.uyan.cc/&quot;&gt;友言&lt;/a&gt;实现评论功能，所以要在&lt;code class=&quot;highlighter-rouge&quot;&gt;/_includes/LessOrMore/comments-providers/uyan&lt;/code&gt;文件中把友言的用户id改成你注册友言的账号id。&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;section-4&quot;&gt;如何写文章&lt;/h2&gt;

&lt;blockquote&gt;
  &lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;/_posts/&lt;/code&gt;目录下是所有发布的博客文件夹。&lt;/p&gt;
&lt;/blockquote&gt;

&lt;blockquote&gt;
  &lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;/source/&lt;/code&gt;目录下是所有发布的博客的资源文件，如博客中用到的图片。&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;在&lt;code class=&quot;highlighter-rouge&quot;&gt;/_posts/&lt;/code&gt;目录下新建一个文件，可以创建文件夹并在文件夹中添加文件，方便维护。在新建文件中粘贴如下信息，并修改以下的&lt;code class=&quot;highlighter-rouge&quot;&gt;titile&lt;/code&gt;,&lt;code class=&quot;highlighter-rouge&quot;&gt;date&lt;/code&gt;,&lt;code class=&quot;highlighter-rouge&quot;&gt;categories&lt;/code&gt;,&lt;code class=&quot;highlighter-rouge&quot;&gt;tag&lt;/code&gt;的相关信息，添加&lt;code class=&quot;highlighter-rouge&quot;&gt;* content {:toc}&lt;/code&gt;为目录相关信息，在进行正文书写前需要在目录和正文之间输入至少2行空行。然后按照正常的Markdown语法书写正文。&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;---
layout: post
&lt;span class=&quot;c&quot;&gt;#标题配置&lt;/span&gt;
title:  标题
&lt;span class=&quot;c&quot;&gt;#时间配置&lt;/span&gt;
date:   2016-08-27 01:08:00 +0800
&lt;span class=&quot;c&quot;&gt;#大类配置&lt;/span&gt;
categories: document
&lt;span class=&quot;c&quot;&gt;#小类配置&lt;/span&gt;
tag: 教程
---

&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt; content
&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;:toc&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;


我是正文。我是正文。我是正文。我是正文。我是正文。我是正文。
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;h2 id=&quot;section-5&quot;&gt;执行&lt;/h2&gt;

&lt;p&gt;在终端中输入下列命令：&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;jekyll server
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;h2 id=&quot;section-6&quot;&gt;效果&lt;/h2&gt;
&lt;p&gt;打开浏览器并输入URL&lt;code class=&quot;highlighter-rouge&quot;&gt;http://localhost:4000/&lt;/code&gt;，回车，即可看到博客运行效果。&lt;/p&gt;

&lt;p&gt;这只是本地查看的效果，真正的博客还是要push到git上。具体不懂的问题可以查看&lt;a href=&quot;http://luckycathome.com/2016/11/15/%E4%BD%BF%E7%94%A8Jekyll%E5%9C%A8GitHub-Pages%E4%B8%8A%E6%90%AD%E5%BB%BA%E4%B8%AA%E4%BA%BA%E5%8D%9A%E5%AE%A2/&quot;&gt;使用Jekyll在GitHub Pages上搭建个人博客&lt;/a&gt;。&lt;/p&gt;

&lt;h1 id=&quot;section-7&quot;&gt;关于重复造轮子&lt;/h1&gt;

&lt;p&gt;很明显，我在重复造轮子。对于造轮子这个事情，我的想法很简单，不是觉得我一定做得比别人好，只是想按照自己的想法尽量写的细一点，或许适合一些人。当然，这个过程更是可以让自己有所长进。&lt;/p&gt;

&lt;h1 id=&quot;section-8&quot;&gt;关于作者&lt;/h1&gt;

&lt;p&gt;热爱开源，热爱折腾的iOS程序猿。更多个人信息和联系方式可以参照&lt;a href=&quot;http://www.LuckyCatHome.com/Resume.io/&quot;&gt;我的简介&lt;/a&gt;。&lt;/p&gt;

</description>
        <pubDate>Thu, 17 Nov 2016 15:22:09 +0800</pubDate>
        <link>http://localhost:4000/2016/11/17/%E5%A6%82%E4%BD%95%E4%BD%BF%E7%94%A8%E6%88%91%E7%9A%84%E5%8D%9A%E5%AE%A2%E4%BD%9C%E4%B8%BAJekyll%E6%A8%A1%E7%89%88/</link>
        <guid isPermaLink="true">http://localhost:4000/2016/11/17/%E5%A6%82%E4%BD%95%E4%BD%BF%E7%94%A8%E6%88%91%E7%9A%84%E5%8D%9A%E5%AE%A2%E4%BD%9C%E4%B8%BAJekyll%E6%A8%A1%E7%89%88/</guid>
        
        <category>Jekyll</category>
        
        
        <category>文档</category>
        
      </item>
    
      <item>
        <title>Jekyll配置友言评论插件</title>
        <description>
&lt;p&gt;我的文件目录如下：&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/source/Jekyll配置友言评论插件/01.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;首先在/_includes/LessOrMore/comments-providers/uyan存放友言的插件脚本。&lt;/p&gt;

&lt;p&gt;去&lt;a href=&quot;http://www.uyan.cc/&quot;&gt;友言&lt;/a&gt;官网去注册一个账号，查看自己的id，然后把下列代码放在uyan这个文件中：&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;div&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;id&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;uyan_frame&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&amp;lt;/&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;div&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;script&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;type&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;text/javascript&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;function&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;dsq&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;document&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;createElement&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;'script'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;dsq&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;type&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;'text/javascript'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;dsq&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;async&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;true&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;dsq&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;src&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;'http://v2.uyan.cc/code/uyan.js?uid=你的ID'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;document&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;getElementsByTagName&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;'head'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;||&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;document&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;getElementsByTagName&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;'body'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;])&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;appendChild&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;dsq&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;})();&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;&amp;lt;/&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;script&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;接下来再编辑/_includes/LessOrMore/comments文件，加上uyan的条件判断，我的该文件代码如下：&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;


  &lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;div&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;id&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;uyan_frame&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&amp;lt;/&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;div&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;script&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;type&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;text/javascript&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;function&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;dsq&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;document&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;createElement&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;'script'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;dsq&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;type&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;'text/javascript'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;dsq&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;async&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;true&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;dsq&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;src&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;'http://v2.uyan.cc/code/uyan.js?uid=2119519'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;document&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;getElementsByTagName&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;'head'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;||&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;document&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;getElementsByTagName&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;'body'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;])&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;appendChild&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;dsq&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;})();&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;&amp;lt;/&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;script&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt;




&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;最后在站点的配置文件_config.yml中指定用youyan作为评论插件就行了&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;  &lt;span class=&quot;c&quot;&gt;# Settings for comments helper&lt;/span&gt;
  &lt;span class=&quot;c&quot;&gt;# Set 'provider' to the comment provider you want to use.&lt;/span&gt;
  &lt;span class=&quot;c&quot;&gt;# Set 'provider' to false to turn commenting off globally.&lt;/span&gt;
  &lt;span class=&quot;c&quot;&gt;#&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;comments&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;provider&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;uyan&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;至此评论插件就配置好了，可以push到Github上看看效果。分享插件的配置也是类似的。&lt;/p&gt;

&lt;p&gt;不push本地预览的话可以查看页面效果但是不能评论，不是bug，push上去就可以了。&lt;/p&gt;
</description>
        <pubDate>Wed, 16 Nov 2016 22:15:31 +0800</pubDate>
        <link>http://localhost:4000/2016/11/16/Jekyll%E9%85%8D%E7%BD%AE%E5%8F%8B%E8%A8%80%E8%AF%84%E8%AE%BA%E6%8F%92%E4%BB%B6/</link>
        <guid isPermaLink="true">http://localhost:4000/2016/11/16/Jekyll%E9%85%8D%E7%BD%AE%E5%8F%8B%E8%A8%80%E8%AF%84%E8%AE%BA%E6%8F%92%E4%BB%B6/</guid>
        
        <category>Jekyll</category>
        
        
        <category>文档</category>
        
      </item>
    
      <item>
        <title>使用Jekyll在GitHub Pages上搭建个人博客</title>
        <description>&lt;ul id=&quot;markdown-toc&quot;&gt;
  &lt;li&gt;&lt;a href=&quot;#step-1-github&quot; id=&quot;markdown-toc-step-1-github&quot;&gt;Step 1. 服务器：GitHub&lt;/a&gt;    &lt;ul&gt;
      &lt;li&gt;&lt;a href=&quot;#github&quot; id=&quot;markdown-toc-github&quot;&gt;1.1. 什么是 GitHub？&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#github-pages&quot; id=&quot;markdown-toc-github-pages&quot;&gt;1.2. 什么是GitHub Pages？&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#github-pages-1&quot; id=&quot;markdown-toc-github-pages-1&quot;&gt;1.3. 创建GitHub Pages博客&lt;/a&gt;&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#step-2-jekyll&quot; id=&quot;markdown-toc-step-2-jekyll&quot;&gt;Step 2. 安装Jekyll&lt;/a&gt;    &lt;ul&gt;
      &lt;li&gt;&lt;a href=&quot;#jekyll&quot; id=&quot;markdown-toc-jekyll&quot;&gt;2.1. 什么是 Jekyll？&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#jekyll-1&quot; id=&quot;markdown-toc-jekyll-1&quot;&gt;2.2. Jekyll目录&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#jekyll-2&quot; id=&quot;markdown-toc-jekyll-2&quot;&gt;2.3. 安装Jekyll&lt;/a&gt;&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#step-3-&quot; id=&quot;markdown-toc-step-3-&quot;&gt;Step 3. 装修博客&lt;/a&gt;    &lt;ul&gt;
      &lt;li&gt;&lt;a href=&quot;#section&quot; id=&quot;markdown-toc-section&quot;&gt;3.1. 如何选择和修改主题？&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#jekyll-3&quot; id=&quot;markdown-toc-jekyll-3&quot;&gt;3.2. 如何使用Jekyll博客模板&lt;/a&gt;&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#step-4-&quot; id=&quot;markdown-toc-step-4-&quot;&gt;Step 4. 独立域名&lt;/a&gt;    &lt;ul&gt;
      &lt;li&gt;&lt;a href=&quot;#section-1&quot; id=&quot;markdown-toc-section-1&quot;&gt;4.1. 购买独立域名&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#github-1&quot; id=&quot;markdown-toc-github-1&quot;&gt;4.2. GitHub上的修改&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#dnspod&quot; id=&quot;markdown-toc-dnspod&quot;&gt;4.3. DnsPod域名解析&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#godaddyns&quot; id=&quot;markdown-toc-godaddyns&quot;&gt;4.4. Godaddy设置NS&lt;/a&gt;&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#step-5-&quot; id=&quot;markdown-toc-step-5-&quot;&gt;Step 5. 评论功能&lt;/a&gt;    &lt;ul&gt;
      &lt;li&gt;&lt;a href=&quot;#section-2&quot; id=&quot;markdown-toc-section-2&quot;&gt;5.1. 注册“友言”&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#section-3&quot; id=&quot;markdown-toc-section-3&quot;&gt;5.2. 使用“友言”&lt;/a&gt;&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;&lt;em&gt;GitHub Pages&lt;/em&gt;  &lt;em&gt;Jekyll&lt;/em&gt;  &lt;em&gt;独立域名&lt;/em&gt;  &lt;em&gt;域名解析&lt;/em&gt;&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;网上已经有足够多的相关介绍了，本人也是根据他人写的文章来做的。实践过程中发现很多文章都多少有些过时，提供的操作流程都是旧版网页的，以至于很多地方遇到障碍。还有，很多东西没有详细解释对于小白来说很是不懂。总之，磕磕绊绊的，在此整理下，希望对别人也能有所用处。&lt;/p&gt;
&lt;/blockquote&gt;

&lt;blockquote&gt;
  &lt;p&gt;网上有很多搭建博客的方式，如果你不知道如何选择，可以看看&lt;a href=&quot;http://www.slant.co/topics/329/~what-is-the-best-solution-for-a-personal-blog&quot;&gt;《What are the best solutions for a personal blog?》&lt;/a&gt;，文章分析了不同博客平台的优缺点和针对人群。最终，我的选择是Jekyll+Github Pages。&lt;/p&gt;
&lt;/blockquote&gt;

&lt;hr /&gt;

&lt;h1 id=&quot;step-1-github&quot;&gt;Step 1. 服务器：GitHub&lt;/h1&gt;

&lt;h2 id=&quot;github&quot;&gt;1.1. 什么是 GitHub？&lt;/h2&gt;

&lt;p&gt;在说GitHub之前，必须要提到Git。Git是分布式版本控制系统。GitHub可以托管各种Git版本库，并提供一个web界面。&lt;/p&gt;

&lt;p&gt;Github 就像是程序员们的Facebook，程序员们，写代码，做项目，在此和全世界的人们分享。&lt;/p&gt;

&lt;p&gt;会使用GitHub的资源，比会搭建个人博客的价值大得多。&lt;/p&gt;

&lt;h2 id=&quot;github-pages&quot;&gt;1.2. 什么是GitHub Pages？&lt;/h2&gt;

&lt;blockquote&gt;
  &lt;p&gt;Website for you and your project.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;GitHub Pages有两种。一种是为个人或者组织的博客。一种是为项目的博客。前者一个账号只能建一个，后者，可以建很多个。&lt;/p&gt;

&lt;p&gt;这样的博客，免费、独立、安全。&lt;/p&gt;

&lt;h2 id=&quot;github-pages-1&quot;&gt;1.3. 创建GitHub Pages博客&lt;/h2&gt;

&lt;ul&gt;
  &lt;li&gt;首先，注册 &lt;a href=&quot;https://github.com/&quot;&gt;Github&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;然后，建立一个仓库&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;&lt;img src=&quot;/source/使用Jekyll在GitHub-Pages上搭建个人博客/GitHub Pages-01.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;&lt;strong&gt;Repository name(仓库名)必须是 your_user_name.github.io&lt;/strong&gt;&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;比如，我的GitHub用户名是LuckyCat7848，那么仓库名就取为 LuckyCat7848.github.io。这一点很重要，必须这么写！因为GitHub上的用户名是唯一的，所以上面说一个账号只能建一个个人博客。&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;
    &lt;p&gt;然后，按照提示步骤操作&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;最后，新建一个index.html文件，push。&lt;/p&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;打开终端，切换到本地GitHub目录下。（本人之前配置过，如果没有操作过的，自己找教程吧。）&lt;/p&gt;

&lt;p&gt;克隆GitHub上的这个Responsitory文件夹到本地：&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/source/使用Jekyll在GitHub-Pages上搭建个人博客/GitHub Pages-02.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;切换到该Responsitory下，并且创建一个只写着Hello World的.html文件：&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/source/使用Jekyll在GitHub-Pages上搭建个人博客/GitHub Pages-03.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;提交这些改动：&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/source/使用Jekyll在GitHub-Pages上搭建个人博客/GitHub Pages-04.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;官网上有命令行和客户端两种操作方式（&lt;a href=&quot;https://pages.github.com/&quot;&gt;官网教程&lt;/a&gt;）。等一小会，网站生效，访问your_user_name.github.io，就能看见完整的网页了，此时网页上还只有一句Hello World。&lt;/p&gt;

&lt;h1 id=&quot;step-2-jekyll&quot;&gt;Step 2. 安装Jekyll&lt;/h1&gt;

&lt;h2 id=&quot;jekyll&quot;&gt;2.1. 什么是 Jekyll？&lt;/h2&gt;

&lt;blockquote&gt;
  &lt;p&gt;&lt;a href=&quot;http://jekyllrb.com/&quot;&gt;Jekyll&lt;/a&gt; is a simple, blog-aware, static site generator.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;blockquote&gt;
  &lt;p&gt;&lt;a href=&quot;http://jekyllrb.com/&quot;&gt;Jekyll&lt;/a&gt; 是一个简单的博客形态的静态站点生产机器。&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;解释一下，Jekyll可以将纯文本转换为静态博客网站。你整个网站的页面都是它生成的，从主页index到文章post。&lt;/p&gt;

&lt;p&gt;比如，文章怎么写？标准网页格式是扩展标记语言HTML。纯手写？未免太麻烦。大家，多偏爱Markdown。所以，就用它写。不过，你需要有一个能把你用Markdown格式写的文章，转化为HTML网页的东西，这里使用的就是静态网页生成器。&lt;/p&gt;

&lt;h2 id=&quot;jekyll-1&quot;&gt;2.2. Jekyll目录&lt;/h2&gt;

&lt;p&gt;解释一下整个Jekyll的目录:
为了之后不至于完全茫然，很值得先看一看，第一次看不懂没关系，用着用着就知道什么意思了。就像练习吉他和弦的转换，开始很难，可换着换着你就会了。&lt;/p&gt;

&lt;p&gt;这个很奇怪的结构是，文件目录树，_config.yml这样的代表一个文件，_drafts这样的代表一个文件夹，与它连接的文件，比如begin-with-the-crazy-ideas.textile，就在文件夹中。一开始，我没怎么看官方文档，嫌麻烦，不如直接开始干。结果是绕了不少弯路，修改主题的时候，找半天各个部分。&lt;/p&gt;

&lt;p&gt;先说需要了解的，其余以后依个人需求学习。&lt;/p&gt;

&lt;blockquote&gt;
  &lt;ul&gt;
    &lt;li&gt;_config.yml 是配置文件，你可以在里面配置你博客会用到的常量，比如博客名，邮件。&lt;/li&gt;
    &lt;li&gt;_includes：就是你文章各个部分的html文件，可以在布局中包含这些文件。&lt;/li&gt;
    &lt;li&gt;_layouts：存放模板。就是你网页的布局，主页布局，文章布局。当然不是指CSS那样的布局，是指，你包含哪些基本的内容到页面上。包含的内容就是includes里面的文件。&lt;/li&gt;
    &lt;li&gt;_posts: 存放博客文章。&lt;/li&gt;
    &lt;li&gt;index：博客主页。&lt;/li&gt;
    &lt;li&gt;CNAME文件：域名地址。&lt;/li&gt;
    &lt;li&gt;CSS：存放博客所用CSS。&lt;/li&gt;
    &lt;li&gt;JS: 存放博客所用JavaScript。&lt;/li&gt;
  &lt;/ul&gt;
&lt;/blockquote&gt;

&lt;p&gt;可以设置每个html文件的title(标题)和layout(布局)。比如index的layout一般是default。你也可以添加其他的页面，加上不同的layout。&lt;/p&gt;

&lt;p&gt;当你想定制博客的时候，以上目录就很有用了。&lt;/p&gt;

&lt;h2 id=&quot;jekyll-2&quot;&gt;2.3. 安装Jekyll&lt;/h2&gt;

&lt;ul&gt;
  &lt;li&gt;安装Ruby，Mac一般默认安装了Ruby，这一步可以忽略。&lt;a href=&quot;https://www.ruby-lang.org/zh_cn/downloads/&quot;&gt;官网安装&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;安装Bundler，在Terminal中输入：&lt;/li&gt;
&lt;/ul&gt;

&lt;blockquote&gt;
  &lt;p&gt;&lt;strong&gt;sudo gem install bundler&lt;/strong&gt;&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;如果出现以下error：（不好意思，图丢失了）&lt;/p&gt;

&lt;p&gt;使用命令行：&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;&lt;strong&gt;sudo gem install -n /usr/local/bin bundler&lt;/strong&gt;&lt;/p&gt;
&lt;/blockquote&gt;

&lt;ul&gt;
  &lt;li&gt;安装Jekyll：&lt;/li&gt;
&lt;/ul&gt;

&lt;blockquote&gt;
  &lt;p&gt;&lt;strong&gt;sudo gem install jekyll&lt;/strong&gt;&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;如果出现以下error：（不好意思，图丢失了）&lt;/p&gt;

&lt;p&gt;使用命令行：&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;&lt;strong&gt;sudo gem install -n /usr/local/bin jekyll&lt;/strong&gt;&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;建议翻墙安装，墙内不知是否会出现问题。&lt;/p&gt;

&lt;h1 id=&quot;step-3-&quot;&gt;Step 3. 装修博客&lt;/h1&gt;

&lt;h2 id=&quot;section&quot;&gt;3.1. 如何选择和修改主题？&lt;/h2&gt;

&lt;ul&gt;
  &lt;li&gt;一种方式是使用他人写好的，免费开源的。&lt;/li&gt;
&lt;/ul&gt;

&lt;blockquote&gt;
  &lt;p&gt;&lt;a href=&quot;http://jekyllthemes.org/&quot;&gt;Jekyll 主题&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;

&lt;ul&gt;
  &lt;li&gt;另一种是，你也可以自己写或修改，需要懂一些前端的知识。&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;jekyll-3&quot;&gt;3.2. 如何使用Jekyll博客模板&lt;/h2&gt;

&lt;ul&gt;
  &lt;li&gt;首先，在&lt;a href=&quot;http://jekyllthemes.org/&quot;&gt;Jekyll 主题&lt;/a&gt;找到喜欢的模板并下载下来。&lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;在终端里切换到your_user_name.github.io目录下，把下载下来的&lt;strong&gt;文件下的全部内容&lt;/strong&gt;转移到当前目录下，可以用命令行也可以直接到文件夹下操作，更方便。最终目录如下：&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;输入jekyll命令本地查看博客效果：&lt;/li&gt;
&lt;/ul&gt;

&lt;blockquote&gt;
  &lt;p&gt;&lt;strong&gt;jekyll serve –watch&lt;/strong&gt;&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;该命令行输入后，jekyll运行起来，就可以在浏览器中输入“http://localhost:4000/”查看网页效果了，终端中按“Ctrl+C”停止运行该命令。&lt;/p&gt;

&lt;p&gt;此时，博客上的内容都不是自己的东西。在终端中终止运行jekyll后，编辑该目录下的_config.yml等文件就可以修改网页上的内容了，参考上述jekyll目录内容自己慢慢摸索即可。&lt;/p&gt;

&lt;h1 id=&quot;step-4-&quot;&gt;Step 4. 独立域名&lt;/h1&gt;

&lt;h2 id=&quot;section-1&quot;&gt;4.1. 购买独立域名&lt;/h2&gt;

&lt;ul&gt;
  &lt;li&gt;购买域名，著名的有&lt;a href=&quot;https://uk.godaddy.com/&quot;&gt;Godaddy&lt;/a&gt;，支持支付宝。在网上可以搜到优惠码，优惠下来价格不高。&lt;/li&gt;
  &lt;li&gt;搜索自己想要的域名，购买时切记去搜索优惠码。&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;结算的时候本人是用信用卡支付的，不同的优惠码优惠的产品和优惠多少和支持的支付方式不同，信用卡的话要用VISA全球卡。&lt;/p&gt;

&lt;p&gt;还有我遇到过结算的时候怎么都结算不了，也是因为优惠码的问题，多试几个就好了。&lt;/p&gt;

&lt;h2 id=&quot;github-1&quot;&gt;4.2. GitHub上的修改&lt;/h2&gt;

&lt;p&gt;在终端中或GitHub上在your_user_name.github.io下修改CNAME文件，在里面写入你刚刚买的域名，例如我的是“LuckyCatHome.com”。&lt;/p&gt;

&lt;p&gt;在终端改的话改完记得向上面那样操作，提交到GitHub上。&lt;/p&gt;

&lt;h2 id=&quot;dnspod&quot;&gt;4.3. DnsPod域名解析&lt;/h2&gt;

&lt;p&gt;&lt;a href=&quot;https://www.dnspod.cn/&quot;&gt;DnsPod&lt;/a&gt;做域名解析处理可以加快博客的访问。&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;首先，注册DnsPods。&lt;/li&gt;
  &lt;li&gt;然后，添加购买好的域名：&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;&lt;img src=&quot;/source/使用Jekyll在GitHub-Pages上搭建个人博客/DnsPod-01.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;然后，设置如下：&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;&lt;img src=&quot;/source/使用Jekyll在GitHub-Pages上搭建个人博客/DnsPod-02.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;第2、3条是默认设置好的。&lt;/p&gt;
&lt;/blockquote&gt;

&lt;blockquote&gt;
  &lt;p&gt;第一条的记录值是“your_user_name.github.io.”，io后面还有一个.，有文章特注了，我也没有试过不写的后果，还是写上吧。&lt;/p&gt;
&lt;/blockquote&gt;

&lt;blockquote&gt;
  &lt;p&gt;最后两条的记录值是GitHub Pages的服务器地址。&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;作用：&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;.com需要使用A记录进行域名解析。&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;告诉所有DNS服务器，对于LuckyCat.com的访问都会被重定向到LuckyCat7848.github.io。&lt;/p&gt;

&lt;h2 id=&quot;godaddyns&quot;&gt;4.4. Godaddy设置NS&lt;/h2&gt;

&lt;ul&gt;
  &lt;li&gt;点击该域名箭头下的“Set Nameservers”：&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;&lt;img src=&quot;/source/使用Jekyll在GitHub-Pages上搭建个人博客/Godaddy-01.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;添加DnsPod的两个默认记录值，如下：&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;&lt;img src=&quot;/source/使用Jekyll在GitHub-Pages上搭建个人博客/Godaddy-02.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;稍等个10分钟左右，在浏览器里输入你的域名就可以看到博客内容啦！&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;不要忘记初衷，在折腾之后，表达写作，才是最重要的事情。&lt;/p&gt;
&lt;/blockquote&gt;

&lt;h1 id=&quot;step-5-&quot;&gt;Step 5. 评论功能&lt;/h1&gt;

&lt;h2 id=&quot;section-2&quot;&gt;5.1. 注册“友言”&lt;/h2&gt;
&lt;p&gt;写好的博客和观看的人交流是必不可少的，互动可以让我们知道自己的不足之处加以改动。&lt;/p&gt;

&lt;p&gt;这里我使用的是免费的&lt;a href=&quot;http://www.uyan.cc/&quot;&gt;友言&lt;/a&gt;。&lt;/p&gt;

&lt;h2 id=&quot;section-3&quot;&gt;5.2. 使用“友言”&lt;/h2&gt;
&lt;p&gt;在_config.yml文件中加上以下一段文字即可：&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/source/使用Jekyll在GitHub-Pages上搭建个人博客/UYan-01.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;使用&lt;a href=&quot;https://github.com/LuckyCat7848/LuckyCat7848.github.io&quot;&gt;该模板&lt;/a&gt;的话只需要在/_includes/LessOrMore/comments-providers/uyan文件中将uid改成你本人的友言uid即可。&lt;/p&gt;

&lt;p&gt;如果不是使用该模板的话，可以参考&lt;a href=&quot;http://luckycathome.com/2016/11/16/Jekyll%E9%85%8D%E7%BD%AE%E5%8F%8B%E8%A8%80%E8%AF%84%E8%AE%BA%E6%8F%92%E4%BB%B6/&quot;&gt;Jekyll配置有言评论插件&lt;/a&gt;。&lt;/p&gt;

</description>
        <pubDate>Tue, 15 Nov 2016 17:55:01 +0800</pubDate>
        <link>http://localhost:4000/2016/11/15/%E4%BD%BF%E7%94%A8Jekyll%E5%9C%A8GitHub-Pages%E4%B8%8A%E6%90%AD%E5%BB%BA%E4%B8%AA%E4%BA%BA%E5%8D%9A%E5%AE%A2/</link>
        <guid isPermaLink="true">http://localhost:4000/2016/11/15/%E4%BD%BF%E7%94%A8Jekyll%E5%9C%A8GitHub-Pages%E4%B8%8A%E6%90%AD%E5%BB%BA%E4%B8%AA%E4%BA%BA%E5%8D%9A%E5%AE%A2/</guid>
        
        <category>Jekyll</category>
        
        
        <category>文档</category>
        
      </item>
    
      <item>
        <title>Xcode磁盘空间大清理</title>
        <description>
&lt;p&gt;&lt;strong&gt;1.移除对旧设备的支持&lt;/strong&gt;
&lt;strong&gt;影响：&lt;/strong&gt;可重新生成；再连接旧设备调试时，会重新自动生成。我移除了4.3.2, 5.0, 5.1等版本的设备支持。
&lt;strong&gt;路径：&lt;/strong&gt;~/Library/Developer/Xcode/iOS DeviceSupport
&lt;strong&gt;释放空间：&lt;/strong&gt;3GB&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;2.移除旧版本的模拟器支持&lt;/strong&gt;
&lt;strong&gt;影响：&lt;/strong&gt;不可恢复；如果需要旧版本的模拟器，就需要重新下载了。我移除了4.3.2, 5.0, 5.1等旧版本的模拟器。
&lt;strong&gt;路径：&lt;/strong&gt;~/Library/Application Support/iPhone Simulator
&lt;strong&gt;释放空间：&lt;/strong&gt;3GB&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;3.移除模拟器的临时文件&lt;/strong&gt;
&lt;strong&gt;影响：&lt;/strong&gt;可重新生成；如果需要保留较新版本的模拟器，但tmp文件夹很大。放心删吧，tmp文件夹里的内容是不重要的。在iOS Device中，存储空间不足时，tmp文件夹是可能被清空的。
&lt;strong&gt;路径：&lt;/strong&gt;~/Library/Application Support/iPhone Simulator/6.1/tmp (以iOS Simulator 6.1为例)
&lt;strong&gt;释放空间：&lt;/strong&gt;2GB&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;4.移除模拟器中安装的Apps&lt;/strong&gt;
&lt;strong&gt;影响：&lt;/strong&gt;不可恢复；对应的模拟器中安装的Apps被清空了，如果不需要就删了吧。
&lt;strong&gt;路径：&lt;/strong&gt;~/Library/Application Support/iPhone Simulator/6.1/Applications (以iOS Simulator 6.1为例)
&lt;strong&gt;释放空间：&lt;/strong&gt;1GB&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;5.移除Archives&lt;/strong&gt;
&lt;strong&gt;影响：&lt;/strong&gt;不可恢复；Adhoc或者App Store版本会被删除。建议备份dSYM文件夹
&lt;strong&gt;路径：&lt;/strong&gt;~/Library/Developer/Xcode/Archives
&lt;strong&gt;释放空间：&lt;/strong&gt;6GB&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;6.移除DerivedData&lt;/strong&gt;
&lt;strong&gt;影响：&lt;/strong&gt;可重新生成；会删除build生成的项目索引、build输出以及日志。重新打开项目时会重新生成，大的项目会耗费一些时间。
&lt;strong&gt;路径：&lt;/strong&gt;~/Library/Developer/Xcode/DerivedData
&lt;strong&gt;释放空间：&lt;/strong&gt;12GB&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;7.移除旧的Docsets&lt;/strong&gt;
&lt;strong&gt;影响：&lt;/strong&gt;不可恢复；将删除旧的Docsets文档
&lt;strong&gt;路径：&lt;/strong&gt;~/Library/Developer/Shared/Documentation/DocSets
&lt;strong&gt;释放空间：&lt;/strong&gt;2GB&lt;/p&gt;

&lt;p&gt;作者一共释放出了30GB左右的磁盘空间，这对128 GB的SSD来说可是不小的数字。如果你的磁盘空间不紧张，或者使用HDD，我建议不要进行这些操作。使用SSD的朋友酌情清理吧。&lt;/p&gt;

</description>
        <pubDate>Thu, 08 Sep 2016 08:11:25 +0800</pubDate>
        <link>http://localhost:4000/2016/09/08/Xcode%E7%A3%81%E7%9B%98%E7%A9%BA%E9%97%B4%E5%A4%A7%E6%B8%85%E7%90%86/</link>
        <guid isPermaLink="true">http://localhost:4000/2016/09/08/Xcode%E7%A3%81%E7%9B%98%E7%A9%BA%E9%97%B4%E5%A4%A7%E6%B8%85%E7%90%86/</guid>
        
        <category>MAC</category>
        
        
        <category>实用技能</category>
        
      </item>
    
      <item>
        <title>将Excel表格转化为plist文件（中国省份和城市信息）</title>
        <description>
&lt;p&gt;将图1的Excel表格转换成图2的.plist文件，两张图如下：&lt;/p&gt;

&lt;p&gt;图1：&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/source/将Excel表格转化为plist文件（中国省份和城市信息）/1479312936089.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;图2：&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/source/将Excel表格转化为plist文件（中国省份和城市信息）/1479312949609.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;hr /&gt;

&lt;p&gt;&lt;strong&gt;1.&lt;/strong&gt; 先把Excel表格另存为.csv格式：&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/source/将Excel表格转化为plist文件（中国省份和城市信息）/1479312967213.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;2.&lt;/strong&gt; 将.csv文件内容复制粘贴到新的.txt文件中;&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;3.&lt;/strong&gt; 将.txt文件拖拽到工程中，用代码读取.txt文件内容写入到.plist文件。&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;NSString&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;path&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;NSBundle&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;mainBundle&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;pathForResource&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;@&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;ProvincesAndCities&quot;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ofType&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;@&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;txt&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;NSString&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;contents&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;NSString&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;alloc&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;initWithContentsOfFile&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;path&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;encoding&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;NSUTF8StringEncoding&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;error&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;nil&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;//&lt;/span&gt; &lt;span class=&quot;err&quot;&gt;获取到&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;excel&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;中&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;n&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;行的数组&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;NSArray&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;contentsArray&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;contents&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;componentsSeparatedByCharactersInSet&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;NSCharacterSet&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;newlineCharacterSet&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]];&lt;/span&gt;

    &lt;span class=&quot;n&quot;&gt;NSString&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;savePath&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;NSHomeDirectory&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;stringByAppendingPathComponent&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;@&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;Documents/ProvincesAndCities.plist&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;

    &lt;span class=&quot;n&quot;&gt;NSMutableArray&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;allArr&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;NSMutableArray&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;array&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;contentsArray&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;count&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;++&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;NSString&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;lineStr&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;contentsArray&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;
        &lt;span class=&quot;o&quot;&gt;//&lt;/span&gt; &lt;span class=&quot;err&quot;&gt;将一行数据转为数组格式，对其遍历，获取单个格里的内容&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;NSArray&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;lineArr&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;lineStr&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;componentsSeparatedByCharactersInSet&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;NSCharacterSet&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;controlCharacterSet&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]];&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;j&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;j&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;lineArr&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;count&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;j&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;++&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;NSString&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;oneStr&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;lineArr&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;j&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;
            &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;!&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;NSString&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;strIsNilOrEmpty&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;oneStr&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;])&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
                &lt;span class=&quot;n&quot;&gt;NSMutableDictionary&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;rowDic&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;nil&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
                &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;i&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
                    &lt;span class=&quot;o&quot;&gt;//&lt;/span&gt; &lt;span class=&quot;err&quot;&gt;第一行是省份名称&lt;/span&gt;
                    &lt;span class=&quot;n&quot;&gt;rowDic&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;NSMutableDictionary&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;alloc&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;init&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;
                    &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;rowDic&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;setObject&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;lineArr&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;j&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;forKey&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;@&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;province&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;
                    &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;allArr&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;addObject&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;rowDic&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;
                &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
                &lt;span class=&quot;k&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
                    &lt;span class=&quot;o&quot;&gt;//&lt;/span&gt; &lt;span class=&quot;err&quot;&gt;城市按每列存在数组中，再保存到每列信息里&lt;/span&gt;
                    &lt;span class=&quot;n&quot;&gt;rowDic&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;NSMutableDictionary&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;dictionaryWithDictionary&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;allArr&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;j&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]];&lt;/span&gt;
                    &lt;span class=&quot;n&quot;&gt;NSMutableArray&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;citiesArr&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;NSMutableArray&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;arrayWithArray&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;rowDic&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;@&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;cities&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]];&lt;/span&gt;
                    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;!&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;citiesArr&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;containsObject&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;oneStr&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;])&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
                        &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;citiesArr&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;addObject&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;oneStr&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;
                    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
                    &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;rowDic&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;setObject&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;citiesArr&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;forKey&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;@&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;cities&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;
                    &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;allArr&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;replaceObjectAtIndex&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;j&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;withObject&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;rowDic&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;
                &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
            &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;//&lt;/span&gt; &lt;span class=&quot;err&quot;&gt;写入到&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;plist&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;文件&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;allArr&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;writeToFile&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;savePath&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;atomically&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;YES&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;&lt;strong&gt;4.&lt;/strong&gt; 最后，就可以直接在工程里删除.txt，使用.plist文件了。&lt;/p&gt;

</description>
        <pubDate>Mon, 22 Feb 2016 13:45:23 +0800</pubDate>
        <link>http://localhost:4000/2016/02/22/%E5%B0%86Excel%E8%A1%A8%E6%A0%BC%E8%BD%AC%E5%8C%96%E4%B8%BAplist%E6%96%87%E4%BB%B6-%E4%B8%AD%E5%9B%BD%E7%9C%81%E4%BB%BD%E5%92%8C%E5%9F%8E%E5%B8%82%E4%BF%A1%E6%81%AF/</link>
        <guid isPermaLink="true">http://localhost:4000/2016/02/22/%E5%B0%86Excel%E8%A1%A8%E6%A0%BC%E8%BD%AC%E5%8C%96%E4%B8%BAplist%E6%96%87%E4%BB%B6-%E4%B8%AD%E5%9B%BD%E7%9C%81%E4%BB%BD%E5%92%8C%E5%9F%8E%E5%B8%82%E4%BF%A1%E6%81%AF/</guid>
        
        <category>Object-C</category>
        
        
        <category>技术</category>
        
      </item>
    
      <item>
        <title>视频截取&amp;裁剪为正方形</title>
        <description>
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c&quot;&gt;#import &amp;lt;AVFoundation/AVFoundation.h&amp;gt;&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;#import &amp;lt;MobileCoreServices/MobileCoreServices.h&amp;gt;&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;#import &quot;CJShortMovieCache.h&quot;&lt;/span&gt;

&lt;span class=&quot;o&quot;&gt;//&lt;/span&gt; &lt;span class=&quot;err&quot;&gt;调用本地相册选取视频（用系统方法截取视频长度）&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;!&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;UIImagePickerController&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;isSourceTypeAvailable&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;UIImagePickerControllerSourceTypeSavedPhotosAlbum&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;])&lt;/span&gt;
            &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
                &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;([[[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;UIDevice&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;currentDevice&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;systemVersion&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;floatValue&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;mf&quot;&gt;8.0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
                    &lt;span class=&quot;n&quot;&gt;UIAlertView&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;alertView&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;UIAlertView&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;alloc&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;initWithTitle&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;@&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;&quot;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;message&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;@&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;请在“设置-隐私-照片”选项中允许烈火访问你的照片&quot;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;delegate&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;bp&quot;&gt;self&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;cancelButtonTitle&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;@&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;确定&quot;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;otherButtonTitles&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;nil&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;
                    &lt;span class=&quot;n&quot;&gt;alertView&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;delegate&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;bp&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
                    &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;alertView&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;show&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;

                &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
                    &lt;span class=&quot;n&quot;&gt;UIAlertController&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;alertController&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;UIAlertController&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;alertControllerWithTitle&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;@&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;&quot;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;message&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;@&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;请在“设置-隐私-照片”选项中允许烈火访问你的照片&quot;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;preferredStyle&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;UIAlertControllerStyleAlert&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;
                    &lt;span class=&quot;n&quot;&gt;UIAlertAction&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;cancelAction&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;UIAlertAction&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;actionWithTitle&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;@&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;确定&quot;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;style&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;UIAlertActionStyleCancel&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;handler&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;nil&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;
                    &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;alertController&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;addAction&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;cancelAction&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;
                    &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;bp&quot;&gt;self&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;presentViewController&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;alertController&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;animated&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;YES&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;completion&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;nil&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;
                &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
                &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
            &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;UIImagePickerController&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;myImagePickerController&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;UIImagePickerController&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;alloc&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;init&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;myImagePickerController&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;sourceType&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;  &lt;span class=&quot;n&quot;&gt;UIImagePickerControllerSourceTypeSavedPhotosAlbum&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;myImagePickerController&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;mediaTypes&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;NSArray&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;alloc&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;initWithObjects&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;NSString&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;kUTTypeMovie&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;nil&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;myImagePickerController&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;delegate&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;weakSelf&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;myImagePickerController&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;allowsEditing&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;YES&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;myImagePickerController&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;videoMaximumDuration&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;12&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;myImagePickerController&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;videoQuality&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;UIImagePickerControllerQualityTypeMedium&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
            &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;weakSelf&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;presentViewController&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;myImagePickerController&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;animated&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;YES&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;completion&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;nil&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;

&lt;span class=&quot;c&quot;&gt;#pragma mark - UIImagePickerControllerDelegate&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;void&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;imagePickerController&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;UIImagePickerController&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;picker&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;didFinishPickingMediaWithInfo&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;NSDictionary&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;info&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;picker&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;dismissViewControllerAnimated&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;YES&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;completion&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;nil&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;

    &lt;span class=&quot;o&quot;&gt;//&lt;/span&gt; &lt;span class=&quot;err&quot;&gt;获取到视频&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;截取后的视频已自动保存到&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;tmp&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;路径下&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;裁剪为正方形&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;转移到所有视频下的位置&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;NSURL&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;trimUrl&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;info&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;objectForKey&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;UIImagePickerControllerMediaURL&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;

    &lt;span class=&quot;o&quot;&gt;//&lt;/span&gt; &lt;span class=&quot;err&quot;&gt;裁剪视频&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;bp&quot;&gt;self&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;cutVideoWithFileUrl&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;trimUrl&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;o&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;void&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;cutVideoWithFileUrl&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;NSURL&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;fileUrl&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;//&lt;/span&gt; &lt;span class=&quot;err&quot;&gt;先取&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;assetTrack&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;，为了取&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;naturalSize&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;NSMutableArray&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;assetTrackArray&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;NSMutableArray&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;alloc&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;init&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;AVAsset&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;asset&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;AVAsset&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;assetWithURL&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;fileUrl&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;

    &lt;span class=&quot;n&quot;&gt;AVAssetTrack&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;assetTrack&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;asset&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;tracksWithMediaType&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;AVMediaTypeVideo&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;objectAtIndex&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;assetTrackArray&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;addObject&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;assetTrack&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;

    &lt;span class=&quot;n&quot;&gt;CGFloat&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;renderW&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;MIN&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;assetTrack&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;naturalSize&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;width&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;assetTrack&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;naturalSize&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;height&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;

    &lt;span class=&quot;o&quot;&gt;//&lt;/span&gt; &lt;span class=&quot;err&quot;&gt;裁剪为正方形&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;NSLog&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;@&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;🍎assetTrack.naturalSize：&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;%.0&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;f  &lt;/span&gt;&lt;span class=&quot;si&quot;&gt;%.0&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;f&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\n&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;assetTrack&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;naturalSize&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;width&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;assetTrack&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;naturalSize&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;height&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;

    &lt;span class=&quot;n&quot;&gt;CGAffineTransform&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;layerTransform&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;assetTrack&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;preferredTransform&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;NSLog&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;@&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;🍎调整前: &lt;/span&gt;&lt;span class=&quot;si&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;f  &lt;/span&gt;&lt;span class=&quot;si&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;f  &lt;/span&gt;&lt;span class=&quot;si&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;f  &lt;/span&gt;&lt;span class=&quot;si&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;f&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;layerTransform&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;a&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;layerTransform&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;b&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;layerTransform&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;c&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;layerTransform&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;d&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;

    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;assetTrack&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;naturalSize&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;width&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;!=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;assetTrack&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;naturalSize&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;height&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;nb&quot;&gt;float&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;differ&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;MAX&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;assetTrack&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;naturalSize&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;width&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;assetTrack&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;naturalSize&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;height&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;MIN&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;assetTrack&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;naturalSize&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;width&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;assetTrack&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;naturalSize&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;height&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;

        &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;layerTransform&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;a&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;layerTransform&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;b&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;mf&quot;&gt;1.0&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;layerTransform&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;c&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;mf&quot;&gt;1.0&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;layerTransform&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;d&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;o&quot;&gt;//&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Portrait&lt;/span&gt;  &lt;span class=&quot;mi&quot;&gt;90&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;err&quot;&gt;宽&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;高&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;layerTransform&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;CGAffineTransformMake&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;assetTrack&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;preferredTransform&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;a&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
                                                   &lt;span class=&quot;n&quot;&gt;assetTrack&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;preferredTransform&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;b&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
                                                   &lt;span class=&quot;n&quot;&gt;assetTrack&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;preferredTransform&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;c&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
                                                   &lt;span class=&quot;n&quot;&gt;assetTrack&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;preferredTransform&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;d&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
                                                   &lt;span class=&quot;n&quot;&gt;assetTrack&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;preferredTransform&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;tx&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
                                                   &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;differ&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;layerTransform&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;a&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;layerTransform&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;b&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;mf&quot;&gt;1.0&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;layerTransform&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;c&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;mf&quot;&gt;1.0&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;layerTransform&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;d&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;o&quot;&gt;//&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;PortraitUpsideDown&lt;/span&gt;  &lt;span class=&quot;mi&quot;&gt;270&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;layerTransform&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;CGAffineTransformMake&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;assetTrack&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;preferredTransform&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;a&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
                                                   &lt;span class=&quot;n&quot;&gt;assetTrack&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;preferredTransform&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;b&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
                                                   &lt;span class=&quot;n&quot;&gt;assetTrack&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;preferredTransform&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;c&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
                                                   &lt;span class=&quot;n&quot;&gt;assetTrack&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;preferredTransform&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;d&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
                                                   &lt;span class=&quot;n&quot;&gt;assetTrack&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;preferredTransform&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;tx&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
                                                   &lt;span class=&quot;n&quot;&gt;differ&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;mf&quot;&gt;1.75&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;layerTransform&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;a&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;mf&quot;&gt;1.0&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;layerTransform&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;b&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;layerTransform&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;c&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;layerTransform&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;d&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;mf&quot;&gt;1.0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;o&quot;&gt;//&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;LandscapeRight&lt;/span&gt;  &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;err&quot;&gt;宽&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;高&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;layerTransform&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;CGAffineTransformMake&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;assetTrack&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;preferredTransform&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;a&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
                                                   &lt;span class=&quot;n&quot;&gt;assetTrack&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;preferredTransform&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;b&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
                                                   &lt;span class=&quot;n&quot;&gt;assetTrack&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;preferredTransform&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;c&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
                                                   &lt;span class=&quot;n&quot;&gt;assetTrack&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;preferredTransform&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;d&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
                                                   &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;differ&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
                                                   &lt;span class=&quot;n&quot;&gt;assetTrack&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;preferredTransform&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ty&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;layerTransform&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;a&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;mf&quot;&gt;1.0&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;layerTransform&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;b&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;layerTransform&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;c&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;layerTransform&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;d&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;mf&quot;&gt;1.0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;o&quot;&gt;//&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;LandscapeLeft&lt;/span&gt;  &lt;span class=&quot;mi&quot;&gt;180&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;layerTransform&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;CGAffineTransformMake&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;assetTrack&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;preferredTransform&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;a&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
                                                   &lt;span class=&quot;n&quot;&gt;assetTrack&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;preferredTransform&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;b&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
                                                   &lt;span class=&quot;n&quot;&gt;assetTrack&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;preferredTransform&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;c&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
                                                   &lt;span class=&quot;n&quot;&gt;assetTrack&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;preferredTransform&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;d&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
                                                   &lt;span class=&quot;n&quot;&gt;differ&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;mf&quot;&gt;1.75&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
                                                   &lt;span class=&quot;n&quot;&gt;assetTrack&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;preferredTransform&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ty&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;NSLog&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;@&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;🍎调整后: &lt;/span&gt;&lt;span class=&quot;si&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;f  &lt;/span&gt;&lt;span class=&quot;si&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;f  &lt;/span&gt;&lt;span class=&quot;si&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;f  &lt;/span&gt;&lt;span class=&quot;si&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;f&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;layerTransform&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;a&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;layerTransform&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;b&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;layerTransform&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;c&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;layerTransform&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;d&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;//&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;layerInstruciton&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;set&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;AVMutableVideoCompositionLayerInstruction&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;layerInstruciton&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;AVMutableVideoCompositionLayerInstruction&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;videoCompositionLayerInstructionWithAssetTrack&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;assetTrack&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;layerInstruciton&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;setTransform&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;layerTransform&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;atTime&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;kCMTimeZero&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;layerInstruciton&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;setOpacity&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;mf&quot;&gt;0.0&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;atTime&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;asset&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;duration&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;

    &lt;span class=&quot;o&quot;&gt;//&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;get&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;save&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;path&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;NSString&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;cutFilePath&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;CJShortMovieCache&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;sharedInstance&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;getKeyPath&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;NSURL&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;cutFileURL&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;NSURL&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;fileURLWithPath&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;cutFilePath&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;

    &lt;span class=&quot;o&quot;&gt;//&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;export&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;AVMutableVideoCompositionInstruction&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;mainInstruciton&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;AVMutableVideoCompositionInstruction&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;videoCompositionInstruction&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;mainInstruciton&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;timeRange&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;CMTimeRangeMake&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;kCMTimeZero&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;asset&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;duration&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;mainInstruciton&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;layerInstructions&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;err&quot;&gt;@&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;layerInstruciton&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;AVMutableVideoComposition&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;mainCompositionInst&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;AVMutableVideoComposition&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;videoComposition&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;mainCompositionInst&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;instructions&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;err&quot;&gt;@&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;mainInstruciton&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;mainCompositionInst&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;frameDuration&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;CMTimeMake&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;30&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;mainCompositionInst&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;renderSize&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;CGSizeMake&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;renderW&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;renderW&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;

    &lt;span class=&quot;n&quot;&gt;AVAssetExportSession&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;exporter&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;AVAssetExportSession&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;alloc&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;initWithAsset&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;asset&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;presetName&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;AVAssetExportPresetMediumQuality&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;exporter&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;videoComposition&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;mainCompositionInst&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;exporter&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;outputURL&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;cutFileURL&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;exporter&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;outputFileType&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;AVFileTypeMPEG4&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;exporter&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;shouldOptimizeForNetworkUse&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;YES&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;exporter&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;exportAsynchronouslyWithCompletionHandler&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;^&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;switch&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;([&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;exporter&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;status&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;])&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;case&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;AVAssetExportSessionStatusFailed&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
                &lt;span class=&quot;n&quot;&gt;NSLog&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;@&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;exporting failed &lt;/span&gt;&lt;span class=&quot;si&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;@&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;exporter&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;error&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]);&lt;/span&gt;
                &lt;span class=&quot;k&quot;&gt;break&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;case&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;AVAssetExportSessionStatusCompleted&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
            &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
                &lt;span class=&quot;n&quot;&gt;NSLog&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;@&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;exporting completed&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
                &lt;span class=&quot;n&quot;&gt;NSRange&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;varRange&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;fileUrl&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;absoluteString&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;rangeOfString&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;@&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;/var&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;
                &lt;span class=&quot;n&quot;&gt;NSString&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;tmpPath&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;fileUrl&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;absoluteString&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;substringFromIndex&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;varRange&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;location&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;
                &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;([[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;NSFileManager&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;defaultManager&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;fileExistsAtPath&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;tmpPath&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;])&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
                    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;([[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;NSFileManager&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;defaultManager&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;removeItemAtPath&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;tmpPath&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;error&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;nil&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;])&lt;/span&gt;
                    &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
                        &lt;span class=&quot;n&quot;&gt;NSLog&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;@&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;Delete /tmp/ repeat video success&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
                    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
                    &lt;span class=&quot;k&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
                        &lt;span class=&quot;n&quot;&gt;NSLog&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;@&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;Delete /tmp/ repeat video failed&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
                    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
                &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
                &lt;span class=&quot;k&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
                    &lt;span class=&quot;n&quot;&gt;NSLog&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;@&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;No duplicate video found under /tmp/&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
                &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
            &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
                &lt;span class=&quot;k&quot;&gt;break&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;case&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;AVAssetExportSessionStatusCancelled&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
                &lt;span class=&quot;n&quot;&gt;NSLog&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;@&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;export cancelled&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
                &lt;span class=&quot;k&quot;&gt;break&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}];&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
</description>
        <pubDate>Fri, 08 Jan 2016 11:45:55 +0800</pubDate>
        <link>http://localhost:4000/2016/01/08/%E8%A7%86%E9%A2%91%E6%88%AA%E5%8F%96&%E8%A3%81%E5%89%AA%E4%B8%BA%E6%AD%A3%E6%96%B9%E5%BD%A2/</link>
        <guid isPermaLink="true">http://localhost:4000/2016/01/08/%E8%A7%86%E9%A2%91%E6%88%AA%E5%8F%96&%E8%A3%81%E5%89%AA%E4%B8%BA%E6%AD%A3%E6%96%B9%E5%BD%A2/</guid>
        
        <category>Object-C</category>
        
        
        <category>技术</category>
        
      </item>
    
      <item>
        <title>AVFoundation知识点：自定义相机</title>
        <description>&lt;ul id=&quot;markdown-toc&quot;&gt;
  &lt;li&gt;&lt;a href=&quot;#section&quot; id=&quot;markdown-toc-section&quot;&gt;一、首先声明以下对象&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#section-1&quot; id=&quot;markdown-toc-section-1&quot;&gt;二、初始化各个对象&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#section-2&quot; id=&quot;markdown-toc-section-2&quot;&gt;三、拍照拿到相应图片&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#section-3&quot; id=&quot;markdown-toc-section-3&quot;&gt;四、保存照片到相册&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#section-4&quot; id=&quot;markdown-toc-section-4&quot;&gt;五、前后置摄像头的切换&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#section-5&quot; id=&quot;markdown-toc-section-5&quot;&gt;六、相机的其它参数设置&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#section-6&quot; id=&quot;markdown-toc-section-6&quot;&gt;七、遇到的一些坑和解决办法&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#section-7&quot; id=&quot;markdown-toc-section-7&quot;&gt;八、写在最后&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;手动调用iPhone的相机硬件，分为以下步骤：&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/source/AVFoundation知识点：自定义相机/01.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;h1 id=&quot;section&quot;&gt;一、首先声明以下对象&lt;/h1&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c&quot;&gt;#import &amp;lt;AVFoundation/AVFoundation.h&amp;gt;&lt;/span&gt;
//捕获设备，通常是前置摄像头，后置摄像头，麦克风（音频输入）
property &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;nonatomic, strong&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; AVCaptureDevice &lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;device;

//AVCaptureDeviceInput 代表输入设备，他使用AVCaptureDevice 来初始化
@property &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;nonatomic, strong&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; AVCaptureDeviceInput &lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;input;

//输出图片
@property &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;nonatomic ,strong&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; AVCaptureStillImageOutput &lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;imageOutput;

//session：由他把输入输出结合在一起，并开始启动捕获设备（摄像头）
@property &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;nonatomic, strong&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; AVCaptureSession &lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;session;

//图像预览层，实时显示捕获的图像
@property &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;nonatomic ,strong&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; AVCaptureVideoPreviewLayer &lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;previewLayer;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;h1 id=&quot;section-1&quot;&gt;二、初始化各个对象&lt;/h1&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;- &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;void&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;cameraDistrict
&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
//    AVCaptureDevicePositionBack  后置摄像头
//    AVCaptureDevicePositionFront 前置摄像头
   self.device &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;self cameraWithPosition:AVCaptureDevicePositionFront];
    self.input &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[[&lt;/span&gt;AVCaptureDeviceInput alloc] initWithDevice:self.device error:nil];

    self.imageOutput &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[[&lt;/span&gt;AVCaptureStillImageOutput alloc] init];

    self.session &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[[&lt;/span&gt;AVCaptureSession alloc] init];
    //     拿到的图像的大小可以自行设定
    //    AVCaptureSessionPreset320x240
    //    AVCaptureSessionPreset352x288
    //    AVCaptureSessionPreset640x480
    //    AVCaptureSessionPreset960x540
    //    AVCaptureSessionPreset1280x720
    //    AVCaptureSessionPreset1920x1080
    //    AVCaptureSessionPreset3840x2160
    self.session.sessionPreset &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; AVCaptureSessionPreset640x480;
    //输入输出设备结合
    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;([&lt;/span&gt;self.session canAddInput:self.input]&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;self.session addInput:self.input];
    &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;([&lt;/span&gt;self.session canAddOutput:self.imageOutput]&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;self.session addOutput:self.imageOutput];
    &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
    //预览层的生成
    self.previewLayer &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[[&lt;/span&gt;AVCaptureVideoPreviewLayer alloc] initWithSession:self.session];
    self.previewLayer.frame &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; CGRectMake&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;0, 64, SCREEN_WIDTH, SCREEN_HEIGHT-64&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;;
    self.previewLayer.videoGravity &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; AVLayerVideoGravityResizeAspectFill;
    &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;self.view.layer addSublayer:self.previewLayer];
    //设备取景开始
    &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;self.session startRunning];
    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;([&lt;/span&gt;_device lockForConfiguration:nil]&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
    //自动闪光灯，
        &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;([&lt;/span&gt;_device isFlashModeSupported:AVCaptureFlashModeAuto]&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;_device setFlashMode:AVCaptureFlashModeAuto];
        &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
        //自动白平衡,但是好像一直都进不去
        &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;([&lt;/span&gt;_device isWhiteBalanceModeSupported:AVCaptureWhiteBalanceModeAutoWhiteBalance]&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;_device setWhiteBalanceMode:AVCaptureWhiteBalanceModeAutoWhiteBalance];
        &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
        &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;_device unlockForConfiguration];
    &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;根据前后置位置拿到相应的摄像头：&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;- &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;AVCaptureDevice &lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;cameraWithPosition:&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;AVCaptureDevicePosition&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;position&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
    NSArray &lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;devices &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;AVCaptureDevice devicesWithMediaType:AVMediaTypeVideo];
    &lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt; AVCaptureDevice &lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;device &lt;span class=&quot;k&quot;&gt;in &lt;/span&gt;devices &lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt; device.position &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; position &lt;span class=&quot;o&quot;&gt;){&lt;/span&gt;
            &lt;span class=&quot;k&quot;&gt;return &lt;/span&gt;device;
        &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;return &lt;/span&gt;nil;
&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;h1 id=&quot;section-2&quot;&gt;三、拍照拿到相应图片&lt;/h1&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;- &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;void&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;photoBtnDidClick
&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
    AVCaptureConnection &lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;conntion &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;self.imageOutput connectionWithMediaType:AVMediaTypeVideo];
      &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;!conntion&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
          NSLog&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;@&lt;span class=&quot;s2&quot;&gt;&quot;拍照失败!&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;;
          &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt;;
          &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;self.imageOutput captureStillImageAsynchronouslyFromConnection:conntion completionHandler:^&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;CMSampleBufferRef imageDataSampleBuffer, NSError &lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;error&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;imageDataSampleBuffer &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; nil&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; ;
          &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
        NSData &lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;imageData &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;AVCaptureStillImageOutput jpegStillImageNSDataRepresentation:imageDataSampleBuffer];
        self.image &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;UIImage imageWithData:imageData];
        &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;self.session stopRunning];
        &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;self.view addSubview:self.cameraImageView];
&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;h1 id=&quot;section-3&quot;&gt;四、保存照片到相册&lt;/h1&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c&quot;&gt;#pragma - 保存至相册&lt;/span&gt;
- &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;void&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;saveImageToPhotoAlbum:&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;UIImage&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;savedImage
&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;

    UIImageWriteToSavedPhotosAlbum&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;savedImage, self, @selector&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;image:didFinishSavingWithError:contextInfo:&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;, NULL&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;;

&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
// 指定回调方法

- &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;void&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;image: &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;UIImage &lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; image didFinishSavingWithError: &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;NSError &lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; error contextInfo: &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;void &lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; contextInfo

&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
    NSString &lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;msg &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; nil ;
    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;error !&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; NULL&lt;span class=&quot;o&quot;&gt;){&lt;/span&gt;
        msg &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; @&lt;span class=&quot;s2&quot;&gt;&quot;保存图片失败&quot;&lt;/span&gt; ;
    &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;else&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
        msg &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; @&lt;span class=&quot;s2&quot;&gt;&quot;保存图片成功&quot;&lt;/span&gt; ;
    &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
    UIAlertView &lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;alert &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[[&lt;/span&gt;UIAlertView alloc] initWithTitle:@&lt;span class=&quot;s2&quot;&gt;&quot;保存图片结果提示&quot;&lt;/span&gt;
                                            message:msg
                                            delegate:self
                                          cancelButtonTitle:@&lt;span class=&quot;s2&quot;&gt;&quot;确定&quot;&lt;/span&gt;
                                          otherButtonTitles:nil];
    &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;alert show];
&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;h1 id=&quot;section-4&quot;&gt;五、前后置摄像头的切换&lt;/h1&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;- &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;void&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;changeCamera&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
    NSUInteger cameraCount &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[[&lt;/span&gt;AVCaptureDevice devicesWithMediaType:AVMediaTypeVideo] count];
    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;cameraCount &amp;gt; 1&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
        NSError &lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;error;
        //给摄像头的切换添加翻转动画
        CATransition &lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;animation &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;CATransition animation]；
        animation.duration &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; .5f；
        animation.timingFunction &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;CAMediaTimingFunction functionWithName:kCAMediaTimingFunctionEaseInEaseOut];
        animation.type &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; @&lt;span class=&quot;s2&quot;&gt;&quot;oglFlip&quot;&lt;/span&gt;;

        AVCaptureDevice &lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;newCamera &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; nil;
        AVCaptureDeviceInput &lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;newInput &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; nil;
  //拿到另外一个摄像头位置
        AVCaptureDevicePosition position &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[[&lt;/span&gt;_input device] position];
        &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;position &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; AVCaptureDevicePositionFront&lt;span class=&quot;o&quot;&gt;){&lt;/span&gt;
            newCamera &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;self cameraWithPosition:AVCaptureDevicePositionBack];
            animation.subtype &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; kCATransitionFromLeft;//动画翻转方向
        &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
            newCamera &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;self cameraWithPosition:AVCaptureDevicePositionFront];
            animation.subtype &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; kCATransitionFromRight;//动画翻转方向
        &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
        //生成新的输入
        newInput &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;AVCaptureDeviceInput deviceInputWithDevice:newCamera error:nil];
        &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;self.previewLayer addAnimation:animation forKey:nil];
        &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;newInput !&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; nil&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;self.session beginConfiguration];
            &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;self.session removeInput:self.input];
            &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;([&lt;/span&gt;self.session canAddInput:newInput]&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
                &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;self.session addInput:newInput];
                self.input &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; newInput;

            &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
                &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;self.session addInput:self.input];
            &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
            &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;self.session commitConfiguration];

        &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;else if&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;error&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
            NSLog&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;@&lt;span class=&quot;s2&quot;&gt;&quot;toggle carema failed, error = %@&quot;&lt;/span&gt;, error&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;;
        &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;h1 id=&quot;section-5&quot;&gt;六、相机的其它参数设置&lt;/h1&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;//AVCaptureFlashMode  闪光灯
//AVCaptureFocusMode  对焦
//AVCaptureExposureMode  曝光
//AVCaptureWhiteBalanceMode  白平衡
//闪光灯和白平衡可以在生成相机时候设置
//曝光要根据对焦点的光线状况而决定,所以和对焦一块写
//point为点击的位置
- &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;void&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;focusAtPoint:&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;CGPoint&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;point&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
    CGSize size &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; self.view.bounds.size;
    CGPoint focusPoint &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; CGPointMake&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt; point.y /size.height ,1-point.x/size.width &lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;;
    NSError &lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;error;
    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;([&lt;/span&gt;self.device lockForConfiguration:&amp;amp;error]&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
        //对焦模式和对焦点
        &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;([&lt;/span&gt;self.device isFocusModeSupported:AVCaptureFocusModeAutoFocus]&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;self.device setFocusPointOfInterest:focusPoint];
            &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;self.device setFocusMode:AVCaptureFocusModeAutoFocus];
        &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
        //曝光模式和曝光点
        &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;([&lt;/span&gt;self.device isExposureModeSupported:AVCaptureExposureModeAutoExpose &lt;span class=&quot;o&quot;&gt;])&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;self.device setExposurePointOfInterest:focusPoint];
            &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;self.device setExposureMode:AVCaptureExposureModeAutoExpose];
        &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;

        &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;self.device unlockForConfiguration];
        //设置对焦动画
        _focusView.center &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; point;
        _focusView.hidden &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; NO;
        &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;UIView animateWithDuration:0.3 animations:^&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
            _focusView.transform &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; CGAffineTransformMakeScale&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;1.25, 1.25&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;;
        &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;completion:^&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;BOOL finished&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;UIView animateWithDuration:0.5 animations:^&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
                _focusView.transform &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; CGAffineTransformIdentity;
            &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; completion:^&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;BOOL finished&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
                _focusView.hidden &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; YES;
            &lt;span class=&quot;o&quot;&gt;}]&lt;/span&gt;;
        &lt;span class=&quot;o&quot;&gt;}]&lt;/span&gt;;
    &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;h1 id=&quot;section-6&quot;&gt;七、遇到的一些坑和解决办法&lt;/h1&gt;

&lt;ul&gt;
  &lt;li&gt;
    &lt;p&gt;前后置摄像头的切换
　　前后值不能切换，各种尝试找了半天没找到有原因。后来发现我在设置图片尺寸的时候设置为1080P [self.session canSetSessionPreset: AVCaptureSessionPreset1920x1080] ，前置摄像头并不支持这么大的尺寸，所以就不能切换前置摄像头。我验证了下 前置摄像头最高支持720P,720P以内可自由切换。　　当然也可以在前后置摄像头切换的时候，根据前后摄像头来设置不同的尺寸，这里不在赘述。&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;焦点位置
　　CGPoint focusPoint = CGPointMake( point.y /size.height ,1-point.x/size.width );
setExposurePointOfInterest：focusPoint 函数后面Point取值范围是取景框左上角（0，0）到取景框右下角（1，1）之间。官方是这么写的：
　　The value of this property is a CGPoint that determines the receiver’s focus point of interest, if it has one. A value of (0,0) indicates that the camera should focus on the top left corner of the image, while a value of (1,1) indicates that it should focus on the bottom right. The default value is (0.5,0.5).
　　我也试了按这个来但位置就是不对，只能按上面的写法才可以。前面是点击位置的y/PreviewLayer的高度，后面是1-点击位置的x/PreviewLayer的宽度&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;对焦和曝光
　　我在设置对焦是 先设置了模式setFocusMode，后设置对焦位置，就会导致很奇怪的现象，对焦位置是你上次点击的位置。所以一定要先设置位置，再设置对焦模式。
　　曝光同上&lt;/p&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;h1 id=&quot;section-7&quot;&gt;八、写在最后&lt;/h1&gt;

&lt;p&gt;　　附上demo:https://github.com/nanshanyi/photographDemo
　　常用到的基本就这么多，写的并不完善，有什么不对的，欢迎大家批评指正，共同学习。&lt;/p&gt;
</description>
        <pubDate>Wed, 05 Aug 2015 13:55:06 +0800</pubDate>
        <link>http://localhost:4000/2015/08/05/AVFoundation%E7%9F%A5%E8%AF%86%E7%82%B9-%E8%87%AA%E5%AE%9A%E4%B9%89%E7%9B%B8%E6%9C%BA/</link>
        <guid isPermaLink="true">http://localhost:4000/2015/08/05/AVFoundation%E7%9F%A5%E8%AF%86%E7%82%B9-%E8%87%AA%E5%AE%9A%E4%B9%89%E7%9B%B8%E6%9C%BA/</guid>
        
        <category>Object-C</category>
        
        
        <category>技术</category>
        
      </item>
    
  </channel>
</rss>
